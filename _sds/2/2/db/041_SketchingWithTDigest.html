<!DOCTYPE html>
<html>
<head>
  <meta name="databricks-html-version" content="1">
<title>041_SketchingWithTDigest - Databricks</title>

<meta charset="utf-8">
<meta name="google" content="notranslate">
<meta name="robots" content="nofollow">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF8">

<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/7f9cefa92f0da43a505f7213ef5a6bb5d4a409ec4e0540a0a55701946063455d/css/main.css">
<link rel="stylesheet" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/7f9cefa92f0da43a505f7213ef5a6bb5d4a409ec4e0540a0a55701946063455d/css/print.css" media="print">
<link rel="icon" type="image/png" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/7f9cefa92f0da43a505f7213ef5a6bb5d4a409ec4e0540a0a55701946063455d/img/favicon.ico"/>
<script>window.settings = {"enableUsageDeliveryConfiguration":false,"enableNotebookNotifications":true,"enableSshKeyUI":true,"defaultInteractivePricePerDBU":0.4,"enableClusterMetricsUI":true,"enableOnDemandClusterType":true,"enableAutoCompleteAsYouType":[],"devTierName":"Community Edition","enableJobsPrefetching":true,"workspaceFeaturedLinks":[{"linkURI":"https://docs.databricks.com/index.html","displayName":"Documentation","icon":"question"},{"linkURI":"https://docs.databricks.com/release-notes/product/index.html","displayName":"Release Notes","icon":"code"},{"linkURI":"https://docs.databricks.com/spark/latest/training/index.html","displayName":"Training & Tutorials","icon":"graduation-cap"}],"enableReservoirTableUI":false,"enableClearStateFeature":true,"dbcForumURL":"http://forums.databricks.com/","enableProtoClusterInfoDeltaPublisher":true,"enableAttachExistingCluster":true,"resetJobListOnConnect":true,"serverlessDefaultSparkVersion":"latest-stable-scala2.11","maxCustomTags":45,"serverlessDefaultMaxWorkers":20,"enableInstanceProfilesUIInJobs":true,"nodeInfo":{"node_types":[{"support_ssh":false,"spark_heap_memory":4800,"instance_type_id":"r3.2xlarge","spark_core_oversubscription_factor":8.0,"node_type_id":"class-node","description":"Class Node","support_cluster_tags":false,"container_memory_mb":6000,"node_instance_type":{"instance_type_id":"r3.2xlarge","provider":"AWS","local_disk_size_gb":160,"compute_units":26.0,"number_of_ips":4,"local_disks":1,"reserved_compute_units":3.64,"gpus":0,"memory_mb":62464,"num_cores":8,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":6144,"is_hidden":false,"category":"Community Edition","num_cores":0.88,"support_port_forwarding":false,"support_ebs_volumes":false,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":20396,"instance_type_id":"r3.xlarge","node_type_id":"r3.xlarge","description":"r3.xlarge","support_cluster_tags":true,"container_memory_mb":25495,"node_instance_type":{"instance_type_id":"r3.xlarge","provider":"AWS","local_disk_size_gb":80,"compute_units":13.0,"number_of_ips":4,"local_disks":1,"reserved_compute_units":3.64,"gpus":0,"memory_mb":31232,"num_cores":4,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":31232,"is_hidden":false,"category":"Memory Optimized","num_cores":4.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":44632,"instance_type_id":"r3.2xlarge","node_type_id":"r3.2xlarge","description":"r3.2xlarge","support_cluster_tags":true,"container_memory_mb":55790,"node_instance_type":{"instance_type_id":"r3.2xlarge","provider":"AWS","local_disk_size_gb":160,"compute_units":26.0,"number_of_ips":4,"local_disks":1,"reserved_compute_units":3.64,"gpus":0,"memory_mb":62464,"num_cores":8,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":62464,"is_hidden":false,"category":"Memory Optimized","num_cores":8.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":93104,"instance_type_id":"r3.4xlarge","node_type_id":"r3.4xlarge","description":"r3.4xlarge","support_cluster_tags":true,"container_memory_mb":116380,"node_instance_type":{"instance_type_id":"r3.4xlarge","provider":"AWS","local_disk_size_gb":320,"compute_units":52.0,"number_of_ips":4,"local_disks":1,"reserved_compute_units":3.64,"gpus":0,"memory_mb":124928,"num_cores":16,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":124928,"is_hidden":false,"category":"Memory Optimized","num_cores":16.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":190048,"instance_type_id":"r3.8xlarge","node_type_id":"r3.8xlarge","description":"r3.8xlarge","support_cluster_tags":true,"container_memory_mb":237560,"node_instance_type":{"instance_type_id":"r3.8xlarge","provider":"AWS","local_disk_size_gb":320,"compute_units":104.0,"number_of_ips":4,"local_disks":2,"reserved_compute_units":3.64,"gpus":0,"memory_mb":249856,"num_cores":32,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":249856,"is_hidden":false,"category":"Memory Optimized","num_cores":32.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":8079,"instance_type_id":"c3.2xlarge","node_type_id":"c3.2xlarge","description":"c3.2xlarge","support_cluster_tags":true,"container_memory_mb":10099,"node_instance_type":{"instance_type_id":"c3.2xlarge","provider":"AWS","local_disk_size_gb":80,"compute_units":28.0,"number_of_ips":4,"local_disks":2,"reserved_compute_units":3.64,"gpus":0,"memory_mb":15360,"num_cores":8,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":15360,"is_hidden":false,"category":"Compute Optimized","num_cores":8.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":19998,"instance_type_id":"c3.4xlarge","node_type_id":"c3.4xlarge","description":"c3.4xlarge","support_cluster_tags":true,"container_memory_mb":24998,"node_instance_type":{"instance_type_id":"c3.4xlarge","provider":"AWS","local_disk_size_gb":160,"compute_units":55.0,"number_of_ips":4,"local_disks":2,"reserved_compute_units":3.64,"gpus":0,"memory_mb":30720,"num_cores":16,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":30720,"is_hidden":false,"category":"Compute Optimized","num_cores":16.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":43837,"instance_type_id":"c3.8xlarge","node_type_id":"c3.8xlarge","description":"c3.8xlarge","support_cluster_tags":true,"container_memory_mb":54796,"node_instance_type":{"instance_type_id":"c3.8xlarge","provider":"AWS","local_disk_size_gb":320,"compute_units":108.0,"number_of_ips":4,"local_disks":2,"reserved_compute_units":3.64,"gpus":0,"memory_mb":61440,"num_cores":32,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":61440,"is_hidden":false,"category":"Compute Optimized","num_cores":32.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":20396,"instance_type_id":"i2.xlarge","node_type_id":"i2.xlarge","description":"i2.xlarge","support_cluster_tags":true,"container_memory_mb":25495,"node_instance_type":{"instance_type_id":"i2.xlarge","provider":"AWS","local_disk_size_gb":800,"compute_units":14.0,"number_of_ips":4,"local_disks":1,"reserved_compute_units":3.64,"gpus":0,"memory_mb":31232,"num_cores":4,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":31232,"is_hidden":false,"category":"Storage Optimized","num_cores":4.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":44632,"instance_type_id":"i2.2xlarge","node_type_id":"i2.2xlarge","description":"i2.2xlarge","support_cluster_tags":true,"container_memory_mb":55790,"node_instance_type":{"instance_type_id":"i2.2xlarge","provider":"AWS","local_disk_size_gb":800,"compute_units":27.0,"number_of_ips":4,"local_disks":2,"reserved_compute_units":3.64,"gpus":0,"memory_mb":62464,"num_cores":8,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":62464,"is_hidden":false,"category":"Storage Optimized","num_cores":8.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":93104,"instance_type_id":"i2.4xlarge","node_type_id":"i2.4xlarge","description":"i2.4xlarge","support_cluster_tags":true,"container_memory_mb":116380,"node_instance_type":{"instance_type_id":"i2.4xlarge","provider":"AWS","local_disk_size_gb":800,"compute_units":53.0,"number_of_ips":4,"local_disks":4,"reserved_compute_units":3.64,"gpus":0,"memory_mb":124928,"num_cores":16,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":124928,"is_hidden":false,"category":"Storage Optimized","num_cores":16.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"display_order":1,"support_ssh":true,"num_gpus":0,"spark_heap_memory":190048,"instance_type_id":"i2.8xlarge","node_type_id":"i2.8xlarge","description":"i2.8xlarge","support_cluster_tags":true,"container_memory_mb":237560,"node_instance_type":{"instance_type_id":"i2.8xlarge","provider":"AWS","local_disk_size_gb":800,"compute_units":104.0,"number_of_ips":4,"local_disks":8,"reserved_compute_units":3.64,"gpus":0,"memory_mb":249856,"num_cores":32,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":249856,"is_hidden":false,"category":"Storage Optimized","num_cores":32.0,"support_port_forwarding":true,"support_ebs_volumes":true,"is_deprecated":false},{"support_ssh":false,"spark_heap_memory":23800,"instance_type_id":"r3.2xlarge","node_type_id":"memory-optimized","description":"Memory Optimized (legacy)","support_cluster_tags":false,"container_memory_mb":28000,"node_instance_type":{"instance_type_id":"r3.2xlarge","provider":"AWS","local_disk_size_gb":160,"compute_units":26.0,"number_of_ips":4,"local_disks":1,"reserved_compute_units":3.64,"gpus":0,"memory_mb":62464,"num_cores":8,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":30720,"is_hidden":true,"category":"Memory Optimized","num_cores":4.0,"support_port_forwarding":false,"support_ebs_volumes":false,"is_deprecated":true},{"support_ssh":false,"spark_heap_memory":9702,"instance_type_id":"c3.4xlarge","node_type_id":"compute-optimized","description":"Compute Optimized (legacy)","support_cluster_tags":false,"container_memory_mb":12128,"node_instance_type":{"instance_type_id":"c3.4xlarge","provider":"AWS","local_disk_size_gb":160,"compute_units":55.0,"number_of_ips":4,"local_disks":2,"reserved_compute_units":3.64,"gpus":0,"memory_mb":30720,"num_cores":16,"local_disk_type":"AHCI","max_attachable_disks":10,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":15360,"is_hidden":true,"category":"Compute Optimized","num_cores":8.0,"support_port_forwarding":false,"support_ebs_volumes":false,"is_deprecated":true}],"default_node_type_id":"class-node"},"sqlAclsDisabledMap":{"spark.databricks.acl.enabled":"false","spark.databricks.acl.sqlOnly":"false"},"enableDatabaseSupportClusterChoice":true,"enableClusterAcls":true,"notebookRevisionVisibilityHorizon":0,"serverlessClusterProductName":"Serverless Pool","showS3TableImportOption":true,"maxEbsVolumesPerInstance":10,"enableRStudioUI":false,"isAdmin":false,"deltaProcessingBatchSize":1000,"timerUpdateQueueLength":100,"sqlAclsEnabledMap":{"spark.databricks.acl.enabled":"true","spark.databricks.acl.sqlOnly":"true"},"enableLargeResultDownload":true,"maxElasticDiskCapacityGB":5000,"serverlessDefaultMinWorkers":2,"zoneInfos":[{"id":"us-west-2a","isDefault":true},{"id":"us-west-2c","isDefault":false},{"id":"us-west-2b","isDefault":false}],"enableCustomSpotPricingUIByTier":true,"serverlessClustersEnabled":true,"enableWorkspaceBrowserSorting":true,"enableSentryLogging":false,"enableFindAndReplace":true,"disallowUrlImportExceptFromDocs":false,"defaultStandardClusterModel":{"cluster_name":"","node_type_id":"class-node","spark_version":"3.5.x-scala2.11","num_workers":8,"autoscale":null,"aws_attributes":{"availability":"SPOT_WITH_FALLBACK","instance_profile_arn":null,"first_on_demand":5.0,"spot_bid_price_percent":100,"zone_id":"us-west-2a"},"autotermination_minutes":120,"default_tags":{"Vendor":"Databricks","Creator":"r.sainudiin@math.canterbury.ac.nz","ClusterName":null,"ClusterId":"<Generated after creation>"}},"enableEBSVolumesUIForJobs":true,"enablePublishNotebooks":false,"enableBitbucketCloud":true,"createTableInNotebookS3Link":{"url":"https://docs.databricks.com/_static/notebooks/data-import/s3.html","displayName":"S3","workspaceFileName":"S3 Example"},"sanitizeHtmlResult":true,"enableJobAclsConfig":true,"enableFullTextSearch":true,"enableElasticSparkUI":false,"enableNewClustersCreate":true,"allowRunOnPendingClusters":true,"applications":false,"useAutoscalingByDefault":false,"enableAzureToolbar":false,"fileStoreBase":"FileStore","enableEmailInAzure":false,"enableRLibraries":true,"enableTableAclsConfig":false,"enableSshKeyUIInJobs":true,"enableDetachAndAttachSubMenu":true,"configurableSparkOptionsSpec":[{"keyPattern":"spark\\.kryo(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.kryo.*","valuePatternDisplay":"*","description":"Configuration options for Kryo serialization"},{"keyPattern":"spark\\.io\\.compression\\.codec","valuePattern":"(lzf|snappy|org\\.apache\\.spark\\.io\\.LZFCompressionCodec|org\\.apache\\.spark\\.io\\.SnappyCompressionCodec)","keyPatternDisplay":"spark.io.compression.codec","valuePatternDisplay":"snappy|lzf","description":"The codec used to compress internal data such as RDD partitions, broadcast variables and shuffle outputs."},{"keyPattern":"spark\\.serializer","valuePattern":"(org\\.apache\\.spark\\.serializer\\.JavaSerializer|org\\.apache\\.spark\\.serializer\\.KryoSerializer)","keyPatternDisplay":"spark.serializer","valuePatternDisplay":"org.apache.spark.serializer.JavaSerializer|org.apache.spark.serializer.KryoSerializer","description":"Class to use for serializing objects that will be sent over the network or need to be cached in serialized form."},{"keyPattern":"spark\\.rdd\\.compress","valuePattern":"(true|false)","keyPatternDisplay":"spark.rdd.compress","valuePatternDisplay":"true|false","description":"Whether to compress serialized RDD partitions (e.g. for StorageLevel.MEMORY_ONLY_SER). Can save substantial space at the cost of some extra CPU time."},{"keyPattern":"spark\\.speculation","valuePattern":"(true|false)","keyPatternDisplay":"spark.speculation","valuePatternDisplay":"true|false","description":"Whether to use speculation (recommended off for streaming)"},{"keyPattern":"spark\\.es(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"es(\\.([^\\.]+))+","valuePattern":".*","keyPatternDisplay":"es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"spark\\.(storage|shuffle)\\.memoryFraction","valuePattern":"0?\\.0*([1-9])([0-9])*","keyPatternDisplay":"spark.(storage|shuffle).memoryFraction","valuePatternDisplay":"(0.0,1.0)","description":"Fraction of Java heap to use for Spark's shuffle or storage"},{"keyPattern":"spark\\.streaming\\.backpressure\\.enabled","valuePattern":"(true|false)","keyPatternDisplay":"spark.streaming.backpressure.enabled","valuePatternDisplay":"true|false","description":"Enables or disables Spark Streaming's internal backpressure mechanism (since 1.5). This enables the Spark Streaming to control the receiving rate based on the current batch scheduling delays and processing times so that the system receives only as fast as the system can process. Internally, this dynamically sets the maximum receiving rate of receivers. This rate is upper bounded by the values `spark.streaming.receiver.maxRate` and `spark.streaming.kafka.maxRatePerPartition` if they are set."},{"keyPattern":"spark\\.streaming\\.receiver\\.maxRate","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.receiver.maxRate","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which each receiver will receive data. Effectively, each stream will consume at most this number of records per second. Setting this configuration to 0 or a negative number will put no limit on the rate. See the deployment guide in the Spark Streaming programing guide for mode details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRatePerPartition","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRatePerPartition","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which data will be read from each Kafka partition when using the Kafka direct stream API introduced in Spark 1.3. See the Kafka Integration guide for more details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRetries","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRetries","valuePatternDisplay":"numeric","description":"Maximum number of consecutive retries the driver will make in order to find the latest offsets on the leader of each partition (a default value of 1 means that the driver will make a maximum of 2 attempts). Only applies to the Kafka direct stream API introduced in Spark 1.3."},{"keyPattern":"spark\\.streaming\\.ui\\.retainedBatches","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.ui.retainedBatches","valuePatternDisplay":"numeric","description":"How many batches the Spark Streaming UI and status APIs remember before garbage collecting."}],"enableReactNotebookComments":true,"enableAdminPasswordReset":false,"checkBeforeAddingAadUser":false,"enableResetPassword":true,"maxClusterTagValueLength":255,"enableJobsSparkUpgrade":true,"createTableInNotebookDBFSLink":{"url":"https://docs.databricks.com/_static/notebooks/data-import/dbfs.html","displayName":"DBFS","workspaceFileName":"DBFS Example"},"perClusterAutoterminationEnabled":true,"enableNotebookCommandNumbers":true,"allowStyleInSanitizedHtml":false,"sparkVersions":[{"key":"1.6.3-db2-hadoop2-scala2.10","displayName":"Spark 1.6.3-db2 (Hadoop 2, Scala 2.10)","packageLabel":"spark-image-aba860a0ffce4f3471fb14aefdcb1d768ac66a53a5ad884c48745ef98aeb9d67","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"3.3.x-gpu-scala2.11","displayName":"3.3 (includes Apache Spark 2.2.0, GPU, Scala 2.11)","packageLabel":"spark-image-86b4917bb6586289ca64e65f64fd23678c297274be6cd6aa6aa01d7b91fed29c","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.1.1-db5-scala2.11","displayName":"Spark 2.1.1-db5 (Scala 2.11)","packageLabel":"spark-image-08d9fc1551087e0876236f19640c4a83116b1649f15137427d21c9056656e80e","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"1.6.x-ubuntu15.10","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.3.x-scala2.10","displayName":"3.3 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-d7df74e188103a4093ff4467dbf0d32886366c984097f6997e0cd87d0f6b2fa5","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"1.4.x-ubuntu15.10","displayName":"Spark 1.4.1 (Hadoop 1, deprecated)","packageLabel":"spark-image-f710650fb8aaade8e4e812368ea87c45cd8cd0b5e6894ca6c94f3354e8daa6dc","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.2.x-scala2.11","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-67ab3a06d1e83d5b60df7063245eb419a2e9fe329aeeb7e7d9713332c669bb17","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.1.1-db6-scala2.10","displayName":"Spark 2.1.1-db6 (Scala 2.10)","packageLabel":"spark-image-177f3f02a6a3432d30068332dc857b9161345bdd2ee8a2d2de05bb05cb4b0f4c","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.1.0-db2-scala2.11","displayName":"Spark 2.1.0-db2 (Scala 2.11)","packageLabel":"spark-image-267c4490a3ab8a39acdbbd9f1d36f6decdecebf013e30dd677faff50f1d9cf8b","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"4.0.x-scala2.11","displayName":"4.0 (includes Apache Spark 2.3.0, Scala 2.11)","packageLabel":"spark-image-04bb47b0bae8165f760972376ce05083bc6102645f3f3851cd1cdf9cba13d6fe","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"2.1.x-gpu-scala2.11","displayName":"Spark 2.1 (Auto-updating, GPU, Scala 2.11 experimental)","packageLabel":"spark-image-d613235f93e0f29838beb2079a958c02a192ed67a502192bc67a8a5f2fb37f35","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.0.0-ubuntu15.10-scala2.10","displayName":"Spark 2.0.0 (Scala 2.10)","packageLabel":"spark-image-073c1b52ace74f251fae2680624a0d8d184a8b57096d1c21c5ce56c29be6a37a","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"latest-stable-gpu-scala2.11","displayName":"Latest stable (GPU, Scala 2.11)","packageLabel":"spark-image-71e2fd18fdbbb732d6adec03e171846687b6ec85a572e5931e8a9ed9b62e7c32","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.4.x-scala2.11","displayName":"3.4 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-a5615cb1adf0d2305f2b93188c6720174ec3e782d100fcbfa96ff870392861df","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.0.2-db3-scala2.10","displayName":"Spark 2.0.2-db3 (Scala 2.10)","packageLabel":"spark-image-584091dedb690de20e8cf22d9e02fdcce1281edda99eedb441a418d50e28088f","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.2.x-scala2.10","displayName":"3.2 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-557788bea0eea16bbf7a8ba13ace07e64dd7fc86270bd5cea086097fe886431f","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"latest-experimental-scala2.10","displayName":"Latest experimental (Scala 2.10)","packageLabel":"spark-image-ec81b6840af02ee2321dd8dfe2587437bbcddf024d4ae287f326a98fac406a6c","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"4.0.x-gpu-scala2.11","displayName":"4.0 (includes Apache Spark 2.3.0, GPU, Scala 2.11)","packageLabel":"spark-image-41e21a0db3b77bc857f10358917ccbf5fbd85290e8429c2176a5fc7a29ce4f18","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.1.0-db1-scala2.11","displayName":"Spark 2.1.0-db1 (Scala 2.11)","packageLabel":"spark-image-e8ad5b72cf0f899dcf2b4720c1f572ab0e87a311d6113b943b4e1d4a7edb77eb","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.1.1-db4-scala2.11","displayName":"Spark 2.1.1-db4 (Scala 2.11)","packageLabel":"spark-image-52bca0ca866e3f4243d3820a783abf3b9b3b553edf234abef14b892657ceaca9","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"latest-rc-scala2.11","displayName":"Latest RC (4.0, Scala 2.11)","packageLabel":"spark-image-04bb47b0bae8165f760972376ce05083bc6102645f3f3851cd1cdf9cba13d6fe","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"latest-stable-scala2.11","displayName":"Latest stable (Scala 2.11)","packageLabel":"spark-image-3961e9af697e7e97441ff848e1cc7f314c9fe21660cd2169b469dd1bbe3460f0","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"2.1.0-db2-scala2.10","displayName":"Spark 2.1.0-db2 (Scala 2.10)","packageLabel":"spark-image-a2ca4f6b58c95f78dca91b1340305ab3fe32673bd894da2fa8e1dc8a9f8d0478","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"1.6.x-ubuntu15.10-hadoop1","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.0.2-db4-scala2.11","displayName":"Spark 2.0.2-db4 (Scala 2.11)","packageLabel":"spark-image-7dbc7583e8271765b8a1508cb9e832768e35489bbde2c4c790bc6766aee2fd7f","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"1.6.1-ubuntu15.10-hadoop1","displayName":"Spark 1.6.1 (Hadoop 1)","packageLabel":"spark-image-21d1cac181b7b8856dd1b4214a3a734f95b5289089349db9d9c926cb87d843db","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.x-gpu-scala2.11","displayName":"Spark 2.0 (Auto-updating, GPU, Scala 2.11 experimental)","packageLabel":"spark-image-968b89f1d0ec32e1ee4dacd04838cae25ef44370a441224177a37980d539d83a","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"1.6.2-ubuntu15.10-hadoop1","displayName":"Spark 1.6.2 (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"next-major-version-scala2.11","displayName":"Next major version (4.0 snapshot, Scala 2.11)","packageLabel":"spark-image-04bb47b0bae8165f760972376ce05083bc6102645f3f3851cd1cdf9cba13d6fe","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"1.6.3-db1-hadoop2-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 2, Scala 2.10)","packageLabel":"spark-image-eaa8d9b990015a14e032fb2e2e15be0b8d5af9627cd01d855df728b67969d5d9","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"1.6.3-db2-hadoop1-scala2.10","displayName":"Spark 1.6.3-db2 (Hadoop 1, Scala 2.10)","packageLabel":"spark-image-14112ea0645bea94333a571a150819ce85573cf5541167d905b7e6588645cf3b","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"3.5.x-scala2.10","displayName":"3.5 LTS (includes Apache Spark 2.2.1, Scala 2.10)","packageLabel":"spark-image-cb1b0de48b4337b75cd84f4827454e6f226f78b43fd3c31720fbfe25269244e5","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"1.6.2-ubuntu15.10-hadoop2","displayName":"Spark 1.6.2 (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"1.6.1-ubuntu15.10-hadoop2","displayName":"Spark 1.6.1 (Hadoop 2)","packageLabel":"spark-image-4cafdf8bc6cba8edad12f441e3b3f0a8ea27da35c896bc8290e16b41fd15496a","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.2-db2-scala2.10","displayName":"Spark 2.0.2-db2 (Scala 2.10)","packageLabel":"spark-image-36d48f22cca7a907538e07df71847dd22aaf84a852c2eeea2dcefe24c681602f","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.x-ubuntu15.10-scala2.11","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.11, deprecated)","packageLabel":"spark-image-8e1c50d626a52eac5a6c8129e09ae206ba9890f4523775f77af4ad6d99a64c44","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.x-scala2.10","displayName":"Spark 2.0 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-859e88079f97f58d50e25163b39a1943d1eeac0b6939c5a65faba986477e311a","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.1.1-db4-scala2.10","displayName":"Spark 2.1.1-db4 (Scala 2.10)","packageLabel":"spark-image-c7c0224de396cd1563addc1ae4bca6ba823780b6babe6c3729ddf73008f29ba4","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"latest-rc-scala2.10","displayName":"Latest RC (Scala 2.10)","packageLabel":"spark-image-ec81b6840af02ee2321dd8dfe2587437bbcddf024d4ae287f326a98fac406a6c","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"latest-stable-scala2.10","displayName":"Latest stable (Scala 2.10)","packageLabel":"spark-image-cb1b0de48b4337b75cd84f4827454e6f226f78b43fd3c31720fbfe25269244e5","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"2.0.2-db1-scala2.11","displayName":"Spark 2.0.2-db1 (Scala 2.11)","packageLabel":"spark-image-c2d623f03dd44097493c01aa54a941fc31978ebe6d759b36c75b716b2ff6ab9c","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.2-db4-scala2.10","displayName":"Spark 2.0.2-db4 (Scala 2.10)","packageLabel":"spark-image-859e88079f97f58d50e25163b39a1943d1eeac0b6939c5a65faba986477e311a","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.1.1-db5-scala2.10","displayName":"Spark 2.1.1-db5 (Scala 2.10)","packageLabel":"spark-image-74133df2c13950431298d1cab3e865c191d83ac33648a8590495c52fc644c654","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"3.4.x-gpu-scala2.11","displayName":"3.4 (includes Apache Spark 2.2.0, GPU, Scala 2.11)","packageLabel":"spark-image-613a129fcaa93423a4de06407c9f93e341ed5c6b02d69179d2703c8bb47e2b99","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"1.5.x-ubuntu15.10","displayName":"Spark 1.5.2 (Hadoop 1, deprecated)","packageLabel":"spark-image-c9d2a8abf41f157a4acc6d52bc721090346f6fea2de356f3a66e388f54481698","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"latest-experimental-gpu-scala2.11","displayName":"Latest experimental (4.1 snapshot, GPU, Scala 2.11)","packageLabel":"spark-image-35a005aa7f84e9ff56e735fe14744e1835f1d4b89b8df81f936ad1d00d79561e","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.2.x-scala2.10","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-d549f2d4a523994ecdf37e531b51d5ec7d8be51534bb0ca5322eaad28ba8f557","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"3.0.x-scala2.11","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-67ab3a06d1e83d5b60df7063245eb419a2e9fe329aeeb7e7d9713332c669bb17","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.0.x-scala2.11","displayName":"Spark 2.0 (Auto-updating, Scala 2.11)","packageLabel":"spark-image-7dbc7583e8271765b8a1508cb9e832768e35489bbde2c4c790bc6766aee2fd7f","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.1.x-scala2.10","displayName":"Spark 2.1 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-177f3f02a6a3432d30068332dc857b9161345bdd2ee8a2d2de05bb05cb4b0f4c","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"3.1.x-scala2.11","displayName":"3.1 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-241fa8b78ee6343242b1756b18076270894385ff40a81172a6fb5eadf66155d3","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.1.0-db3-scala2.10","displayName":"Spark 2.1.0-db3 (Scala 2.10)","packageLabel":"spark-image-25a17d070af155f10c4232dcc6248e36a2eb48c24f8d4fc00f34041b86bd1626","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.0.2-db2-scala2.11","displayName":"Spark 2.0.2-db2 (Scala 2.11)","packageLabel":"spark-image-4fa852ba378e97815083b96c9cada7b962a513ec23554a5fc849f7f1dd8c065a","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"3.1.x-scala2.10","displayName":"3.1 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-7efac6b9a8f2da59cb4f6d0caac46cfcb3f1ebf64c8073498c42d0360f846714","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.3.x-scala2.11","displayName":"3.3 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-0badc3d8dfc8cddd55795d02c0b31c76330cfe687d588414f91278197fbc9416","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"next-major-version-gpu-scala2.11","displayName":"Next major version (4.0 snapshot, GPU, Scala 2.11)","packageLabel":"spark-image-41e21a0db3b77bc857f10358917ccbf5fbd85290e8429c2176a5fc7a29ce4f18","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.5.x-gpu-scala2.11","displayName":"3.5 LTS (includes Apache Spark 2.2.1, GPU, Scala 2.11)","packageLabel":"spark-image-877b9d158b8820a94d954b4f280eb2200b22218dc153731d1e1765abc6dfaafd","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"1.3.x-ubuntu15.10","displayName":"Spark 1.3.0 (Hadoop 1, deprecated)","packageLabel":"spark-image-40d2842670bc3dc178b14042501847d76171437ccf70613fa397a7a24c48b912","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.0.1-db1-scala2.11","displayName":"Spark 2.0.1-db1 (Scala 2.11)","packageLabel":"spark-image-10ab19f634bbfdb860446c326a9f76dc25bfa87de6403b980566279142a289ea","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.2-db3-scala2.11","displayName":"Spark 2.0.2-db3 (Scala 2.11)","packageLabel":"spark-image-7fd7aaa89d55692e429115ae7eac3b1a1dc4de705d50510995f34306b39c2397","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.1.1-db6-scala2.11","displayName":"Spark 2.1.1-db6 (Scala 2.11)","packageLabel":"spark-image-fdad9ef557700d7a8b6bde86feccbcc3c71d1acdc838b0fd299bd19956b1076e","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"1.6.3-db1-hadoop1-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 1, Scala 2.10)","packageLabel":"spark-image-d50af1032799546b8ccbeeb76889a20c819ebc2a0e68ea20920cb30d3895d3ae","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.0.2-db1-scala2.10","displayName":"Spark 2.0.2-db1 (Scala 2.10)","packageLabel":"spark-image-654bdd6e9bad70079491987d853b4b7abf3b736fff099701501acaabe0e75c41","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.0.x-ubuntu15.10","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.10, deprecated)","packageLabel":"spark-image-a659f3909d51b38d297b20532fc807ecf708cfb7440ce9b090c406ab0c1e4b7e","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"3.5.x-scala2.11","displayName":"3.5 LTS (includes Apache Spark 2.2.1, Scala 2.11)","packageLabel":"spark-image-3961e9af697e7e97441ff848e1cc7f314c9fe21660cd2169b469dd1bbe3460f0","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"latest-experimental-scala2.11","displayName":"Latest experimental (4.1 snapshot, Scala 2.11)","packageLabel":"spark-image-6483f1872dafe4471df05d012a2836eab7b44ee6ae4080f6db4d397c0f3e647c","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},{"key":"3.2.x-scala2.11","displayName":"3.2 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-5537926238bc55cb6cd76ee0f0789511349abead3781c4780721a845f34b5d4e","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":[]},{"key":"2.0.1-db1-scala2.10","displayName":"Spark 2.0.1-db1 (Scala 2.10)","packageLabel":"spark-image-5a13c2db3091986a4e7363006cc185c5b1108c7761ef5d0218506cf2e6643840","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.1.x-scala2.11","displayName":"Spark 2.1 (Auto-updating, Scala 2.11)","packageLabel":"spark-image-fdad9ef557700d7a8b6bde86feccbcc3c71d1acdc838b0fd299bd19956b1076e","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"2.1.0-db1-scala2.10","displayName":"Spark 2.1.0-db1 (Scala 2.10)","packageLabel":"spark-image-f0ab82a5deb7908e0d159e9af066ba05fb56e1edb35bdad41b7ad2fd62a9b546","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"3.0.x-scala2.10","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-d549f2d4a523994ecdf37e531b51d5ec7d8be51534bb0ca5322eaad28ba8f557","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"1.6.0-ubuntu15.10","displayName":"Spark 1.6.0 (Hadoop 1)","packageLabel":"spark-image-10ef758029b8c7e19cd7f4fb52fff9180d75db92ca071bd94c47f3c1171a7cb5","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"1.6.x-ubuntu15.10-hadoop2","displayName":"Spark 1.6.x (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"2.0.0-ubuntu15.10-scala2.11","displayName":"Spark 2.0.0 (Scala 2.11)","packageLabel":"spark-image-b4ec141e751f201399f8358a82efee202560f7ed05e1a04a2ae8778f6324b909","upgradable":true,"deprecated":true,"customerVisible":false,"capabilities":[]},{"key":"2.1.0-db3-scala2.11","displayName":"Spark 2.1.0-db3 (Scala 2.11)","packageLabel":"spark-image-ccbc6b73f158e2001fc1fb8c827bfdde425d8bd6d65cb7b3269784c28bb72c16","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]},{"key":"latest-rc-gpu-scala2.11","displayName":"Latest RC (4.0, gpu-scala 2.11)","packageLabel":"spark-image-41e21a0db3b77bc857f10358917ccbf5fbd85290e8429c2176a5fc7a29ce4f18","upgradable":true,"deprecated":false,"customerVisible":false,"capabilities":[]},{"key":"3.4.x-scala2.10","displayName":"3.4 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-b768d65de82a89fbfabff8ec1d2f279ced527c0ec05e83c3ae0c206d2e97edc0","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION"]}],"enablePresentationMode":false,"enableClearStateAndRunAll":true,"enableTableAclsByTier":true,"enableRestrictedClusterCreation":false,"enableFeedback":false,"enableClusterAutoScaling":false,"enableUserVisibleDefaultTags":true,"defaultNumWorkers":8,"serverContinuationTimeoutMillis":10000,"jobsUnreachableThresholdMillis":60000,"driverStderrFilePrefix":"stderr","enableNotebookRefresh":false,"createTableInNotebookImportedFileLink":{"url":"https://docs.databricks.com/_static/notebooks/data-import/imported-file.html","displayName":"Imported File","workspaceFileName":"Imported File Example"},"accountsOwnerUrl":"https://accounts.cloud.databricks.com/registration.html#login","tableAclsDisabledMap":{"spark.databricks.acl.dfAclsEnabled":"false"},"driverStdoutFilePrefix":"stdout","showDbuPricing":true,"databricksDocsBaseHostname":"docs.databricks.com","defaultNodeTypeToPricingUnitsMap":{"r3.2xlarge":2,"i3.4xlarge":4,"class-node":1,"m4.2xlarge":1.5,"r4.xlarge":1,"m4.4xlarge":3,"Standard_DS5_v2":3,"Standard_D2s_v3":0.5,"Standard_DS4_v2_Promo":1.5,"Standard_DS14":4,"Standard_DS11_v2_Promo":0.5,"r4.16xlarge":16,"Standard_DS11":0.5,"Standard_D2_v3":0.5,"Standard_DS14_v2_Promo":4,"Standard_D64s_v3":12,"p2.8xlarge":16,"m4.10xlarge":8,"Standard_D8s_v3":1.5,"Standard_E32s_v3":8,"Standard_DS3":0.75,"Standard_DS2_v2":0.5,"r3.8xlarge":8,"r4.4xlarge":4,"dev-tier-node":1,"Standard_L8s":2,"Standard_DS13_v2_Promo":2,"Standard_E4s_v3":1,"Standard_D3_v2":0.75,"Standard_DS15_v2":5,"Standard_D16s_v3":3,"Standard_D5_v2":3,"Standard_E8s_v3":2,"Standard_DS2_v2_Promo":0.5,"c3.8xlarge":4,"Standard_D4_v3":0.75,"Standard_E2s_v3":0.5,"Standard_D32_v3":6,"Standard_DS3_v2":0.75,"r3.4xlarge":4,"Standard_DS4":1.5,"i2.4xlarge":6,"Standard_DS3_v2_Promo":0.75,"m4.xlarge":0.75,"r4.8xlarge":8,"Standard_H16":4,"Standard_DS14_v2":4,"r4.large":0.5,"Standard_DS12":1,"development-node":1,"i2.2xlarge":3,"g2.8xlarge":6,"i3.large":0.75,"memory-optimized":1,"m4.large":0.4,"Standard_D16_v3":3,"Standard_F4s":0.5,"p2.16xlarge":24,"i3.8xlarge":8,"Standard_D32s_v3":6,"i3.16xlarge":16,"Standard_DS12_v2":1,"Standard_L32s":8,"Standard_D4s_v3":0.75,"Standard_DS13":2,"Standard_DS11_v2":0.5,"Standard_DS12_v2_Promo":1,"Standard_DS13_v2":2,"c3.2xlarge":1,"Standard_L4s":1,"Standard_F16s":2,"c4.2xlarge":1,"Standard_L16s":4,"i2.xlarge":1.5,"Standard_DS2":0.5,"compute-optimized":1,"c4.4xlarge":2,"Standard_DS5_v2_Promo":3,"Standard_D64_v3":12,"Standard_D2_v2":0.5,"Standard_D8_v3":1.5,"i3.2xlarge":2,"Standard_E16s_v3":4,"Standard_F8s":1,"c3.4xlarge":2,"g2.2xlarge":1.5,"p2.xlarge":2,"m4.16xlarge":12,"Standard_DS4_v2":1.5,"c4.8xlarge":4,"i3.xlarge":1,"r3.xlarge":1,"r4.2xlarge":2,"i2.8xlarge":12},"tableFilesBaseFolder":"/tables","enableSparkDocsSearch":true,"sparkHistoryServerEnabled":true,"enableClusterAppsUIOnServerless":false,"enableEBSVolumesUI":true,"homePageWelcomeMessage":"Welcome to ","metastoreServiceRowLimit":1000000,"enableIPythonImportExport":true,"enableClusterTagsUIForJobs":true,"enableClusterTagsUI":true,"enableNotebookHistoryDiffing":true,"branch":"2.66.997","accountsLimit":-1,"enableSparkEnvironmentVariables":true,"enableX509Authentication":false,"useAADLogin":false,"enableStructuredStreamingNbOptimizations":true,"enableNotebookGitBranching":true,"local":false,"enableNotebookLazyRenderWrapper":false,"enableClusterAutoScalingForJobs":true,"enableStrongPassword":false,"showReleaseNote":true,"displayDefaultContainerMemoryGB":6,"broadenedEditPermission":false,"disableS3TableImport":false,"enableArrayParamsEdit":true,"deploymentMode":"production","useSpotForWorkers":true,"removePasswordInAccountSettings":false,"preferStartTerminatedCluster":false,"enableUserInviteWorkflow":true,"createTableConnectorOptionLinks":[{"url":"https://docs.databricks.com/_static/notebooks/redshift.html","displayName":"Amazon Redshift","workspaceFileName":"Amazon Redshift Example"},{"url":"https://docs.databricks.com/_static/notebooks/structured-streaming-kinesis.html","displayName":"Amazon Kinesis","workspaceFileName":"Amazon Kinesis Example"},{"url":"https://docs.databricks.com/_static/notebooks/data-import/jdbc.html","displayName":"JDBC","workspaceFileName":"JDBC Example"},{"url":"https://docs.databricks.com/_static/notebooks/cassandra.html","displayName":"Cassandra","workspaceFileName":"Cassandra Example"},{"url":"https://docs.databricks.com/_static/notebooks/structured-streaming-etl-kafka.html","displayName":"Kafka","workspaceFileName":"Kafka Example"},{"url":"https://docs.databricks.com/_static/notebooks/redis.html","displayName":"Redis","workspaceFileName":"Redis Example"},{"url":"https://docs.databricks.com/_static/notebooks/elasticsearch.html","displayName":"Elasticsearch","workspaceFileName":"Elasticsearch Example"}],"enableStaticNotebooks":true,"enableNewLineChart":true,"sandboxForUrlSandboxFrame":"allow-scripts allow-popups allow-popups-to-escape-sandbox allow-forms","enableCssTransitions":true,"serverlessEnableElasticDisk":true,"minClusterTagKeyLength":1,"showHomepageFeaturedLinks":true,"pricingURL":"https://databricks.com/product/pricing","enableClusterEdit":true,"enableClusterAclsConfig":true,"useTempS3UrlForTableUpload":false,"notifyLastLogin":false,"enableSshKeyUIByTier":true,"enableCreateClusterOnAttach":false,"defaultAutomatedPricePerDBU":0.2,"enableNotebookGitVersioning":true,"defaultMinWorkers":2,"files":"files/","feedbackEmail":"feedback@databricks.com","enableDriverLogsUI":true,"enableExperimentalCharts":false,"defaultMaxWorkers":8,"enableWorkspaceAclsConfig":true,"serverlessRunPythonAsLowPrivilegeUser":false,"dropzoneMaxFileSize":2047,"enableNewClustersList":true,"enableNewDashboardViews":true,"enableJobListPermissionFilter":true,"driverLog4jFilePrefix":"log4j","enableSingleSignOn":true,"enableMavenLibraries":true,"displayRowLimit":1000,"deltaProcessingAsyncEnabled":true,"enableSparkEnvironmentVariablesUI":false,"defaultSparkVersion":{"key":"3.5.x-scala2.11","displayName":"3.5 LTS (includes Apache Spark 2.2.1, Scala 2.11)","packageLabel":"spark-image-4f5f9fb3a7177ac43f84a20f819e8ad76833e356707ed0b79812a2f837ac0a06","upgradable":true,"deprecated":false,"customerVisible":true,"capabilities":["SUPPORTS_END_TO_END_ENCRYPTION","SUPPORTS_TABLE_ACLS"]},"enableNewLineChartParams":false,"deprecatedEnableStructuredDataAcls":true,"enableCustomSpotPricing":true,"enableMountAclsConfig":false,"defaultAutoterminationMin":120,"useDevTierHomePage":false,"disableExportNotebook":false,"enableClusterClone":true,"enableNotebookLineNumbers":true,"enablePublishHub":false,"notebookHubUrl":"http://hub.dev.databricks.com/","showSqlEndpoints":false,"enableNotebookDatasetInfoView":true,"defaultTagKeys":{"CLUSTER_NAME":"ClusterName","VENDOR":"Vendor","CLUSTER_TYPE":"ResourceClass","CREATOR":"Creator","CLUSTER_ID":"ClusterId"},"enableClusterAclsByTier":true,"databricksDocsBaseUrl":"https://docs.databricks.com/","azurePortalLink":"https://portal.azure.com","cloud":"AWS","customSparkVersionPrefix":"custom:","disallowAddingAdmins":false,"enableSparkConfUI":true,"enableClusterEventsUI":false,"featureTier":"UNKNOWN_TIER","mavenCentralSearchEndpoint":"http://search.maven.org/solrsearch/select","defaultServerlessClusterModel":{"cluster_name":"","node_type_id":"i3.2xlarge","spark_version":"latest-stable-scala2.11","num_workers":null,"enable_jdbc_auto_start":true,"custom_tags":{"ResourceClass":"Serverless"},"autoscale":{"min_workers":2,"max_workers":20},"spark_conf":{"spark.databricks.cluster.profile":"serverless","spark.databricks.repl.allowedLanguages":"sql,python,r","spark.databricks.acl.enabled":"false","spark.databricks.acl.sqlOnly":"false"},"aws_attributes":{"ebs_volume_count":null,"availability":"SPOT_WITH_FALLBACK","first_on_demand":1,"ebs_volume_type":null,"spot_bid_price_percent":100,"zone_id":"us-west-2a","ebs_volume_size":null},"autotermination_minutes":0,"enable_elastic_disk":true,"default_tags":{"Vendor":"Databricks","Creator":"r.sainudiin@math.canterbury.ac.nz","ClusterName":null,"ClusterId":"<Generated after creation>"}},"enableOrgSwitcherUI":false,"bitbucketCloudBaseApiV2Url":"https://api.bitbucket.org/2.0","clustersLimit":-1,"enableJdbcImport":true,"enableClusterAppsUIOnNormalClusters":false,"enableElasticDisk":true,"logfiles":"logfiles/","enableRelativeNotebookLinks":true,"enableMultiSelect":true,"homePageLogo":"login/databricks_logoTM_rgb_TM.svg","enableWebappSharding":false,"enableNotebookParamsEdit":true,"enableClusterDeltaUpdates":true,"enableSingleSignOnLogin":false,"separateTableForJobClusters":true,"ebsVolumeSizeLimitGB":{"GENERAL_PURPOSE_SSD":[100,4096],"THROUGHPUT_OPTIMIZED_HDD":[500,4096]},"enableMountAcls":false,"requireEmailUserName":true,"enableRServerless":true,"dbcFeedbackURL":"http://feedback.databricks.com/forums/263785-product-feedback","enableMountAclService":true,"showVersion":true,"serverlessClustersByDefault":false,"enableWorkspaceAcls":true,"maxClusterTagKeyLength":127,"gitHash":"","clusterTagReservedPrefixes":[],"tableAclsEnabledMap":{"spark.databricks.acl.dfAclsEnabled":"true"},"showWorkspaceFeaturedLinks":true,"signupUrl":"https://databricks.com/try-databricks","databricksDocsNotebookPathPrefix":"^https://docs\\.databricks\\.com/_static/notebooks/.+$","serverlessAttachEbsVolumesByDefault":false,"enableTokensConfig":false,"allowFeedbackForumAccess":true,"enablePythonVersionUI":true,"enableImportFromUrl":true,"allowDisplayHtmlByUrl":true,"enableTokens":true,"enableMiniClusters":false,"enableNewJobList":true,"enableDebugUI":false,"enableStreamingMetricsDashboard":true,"allowNonAdminUsers":true,"enableSingleSignOnByTier":false,"enableJobsRetryOnTimeout":true,"loginLogo":"/login/databricks_logoTM_rgb_TM.svg","useStandardTierUpgradeTooltips":false,"staticNotebookResourceUrl":"https://databricks-prod-cloudfront.cloud.databricks.com/static/7f9cefa92f0da43a505f7213ef5a6bb5d4a409ec4e0540a0a55701946063455d/","enableSpotClusterType":true,"enableSparkPackages":true,"checkAadUserInWorkspaceTenant":false,"dynamicSparkVersions":true,"useIframeForHtmlResult":false,"enableClusterTagsUIByTier":true,"enableNotebookHistoryUI":true,"addWhitespaceAfterLastNotebookCell":true,"enableClusterLoggingUI":true,"enableDatabaseDropdownInTableUI":true,"showDebugCounters":false,"enableInstanceProfilesUI":true,"enableFolderHtmlExport":true,"homepageFeaturedLinks":[{"linkURI":"https://docs.databricks.com/_static/notebooks/gentle-introduction-to-apache-spark.html","displayName":"Introduction to Apache Spark on Databricks","icon":"img/home/Python_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/databricks-for-data-scientists.html","displayName":"Databricks for Data Scientists","icon":"img/home/Scala_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/structured-streaming-python.html","displayName":"Introduction to Structured Streaming","icon":"img/home/Python_icon.svg"}],"enableClusterStart":true,"maxImportFileVersion":5,"enableEBSVolumesUIByTier":true,"enableTableAclService":true,"removeSubCommandCodeWhenExport":true,"upgradeURL":"","maxAutoterminationMinutes":10000,"showResultsFromExternalSearchEngine":true,"autoterminateClustersByDefault":false,"notebookLoadingBackground":"#fff","sshContainerForwardedPort":2200,"enableServerAutoComplete":true,"enableStaticHtmlImport":true,"enableInstanceProfilesByTier":true,"showForgotPasswordLink":true,"defaultMemoryPerContainerMB":6000,"enablePresenceUI":true,"minAutoterminationMinutes":10,"accounts":false,"useOnDemandClustersByDefault":false,"useFramedStaticNotebooks":false,"enableNewProgressReportUI":true,"enableAutoCreateUserUI":true,"defaultCoresPerContainer":4,"showTerminationReason":true,"enableNewClustersGet":true,"showPricePerDBU":false,"showSqlProxyUI":true,"enableNotebookErrorHighlighting":true};</script>
<script>var __DATABRICKS_NOTEBOOK_MODEL = {"version":"NotebookV1","origId":208432,"name":"041_SketchingWithTDigest","language":"scala","commands":[{"version":"CommandV1","origId":208465,"guid":"68e7d354-d9ea-42f5-9860-c68687b39256","subtype":"command","commandType":"auto","position":0.125,"command":"%md\n\n# [SDS-2.2, Scalable Data Science](https://lamastex.github.io/scalable-data-science/sds/2/2/)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"bb2d2ca8-3b45-49f3-a7f6-782a336fa37c"},{"version":"CommandV1","origId":208477,"guid":"616151e2-c6ef-4e47-b8b3-84ed53af88c9","subtype":"command","commandType":"auto","position":0.1875,"command":"%md\n# Sketching with T-digest for quantiles\n## A Toy Anomaly Detector\n\nFisher noticed the fundamental computational difference between mean, covariance, etc. and median, quantiles, in early 1900s.\n\nThe former ones are today called recursively computable statistics. When you take the memory footprint needed to keep these statistics updated then we get into the world of probabilistic datastructures...\n\nThe basic idea of sketching is formally conveyed in Chapter 6 of [Foundations of data Science](https://www.cs.cornell.edu/jeh/book.pdf).\n\nLet's get a more informal view form the following sources.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"92b18b79-8f54-4003-93e2-b851327a8f5b"},{"version":"CommandV1","origId":208478,"guid":"af1cf295-9d2a-4c6f-91d8-1708def6af0a","subtype":"command","commandType":"auto","position":0.21875,"command":"%md\n\n* Read now: https://medium.com/@muppal/probabilistic-data-structures-in-the-big-data-world-code-b9387cff0c55\n* See Ted Dunning's explanation of t-digest now: https://www.youtube.com/watch?v=B0dMc0t7K1g","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"496a951c-4319-4221-bd6c-071fe1f0c736"},{"version":"CommandV1","origId":208433,"guid":"f258d781-fd8a-49e2-aaf2-8c846ac0dcdd","subtype":"command","commandType":"auto","position":0.25,"command":"%md\n# Demonstration of t-digest to detect anomalous scores","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2c3dd7e7-a3d6-4f41-b90e-f85cc94331ad"},{"version":"CommandV1","origId":208434,"guid":"e0cb0a07-7f12-479a-be86-16fc031065c8","subtype":"command","commandType":"auto","position":0.375,"command":"%md\nLet us import the following scala implementation of t-digest:\n\n* maven coordinates: `isarn-sketches-spark_2.11-0.3.0-sp2.2-py2.7`\n\nSee the library: [https://github.com/isarn/isarn-sketches-spark](https://github.com/isarn/isarn-sketches-spark)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"dc0e2a10-0856-422f-8bee-84cbe7c5c6f2"},{"version":"CommandV1","origId":208435,"guid":"f6170b8a-f5f4-4ab3-b05e-41e6dfe9e8e6","subtype":"command","commandType":"auto","position":0.5,"command":"import org.isarnproject.sketches._\nimport org.isarnproject.sketches.udaf._\nimport org.apache.spark.isarnproject.sketches.udt._\nimport org.isarnproject.sketches._\nimport org.isarnproject.sketches.udaf._\nimport org.apache.spark.isarnproject.sketches.udt._\n","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">import org.isarnproject.sketches._\nimport org.isarnproject.sketches.udaf._\nimport org.apache.spark.isarnproject.sketches.udt._\nimport org.isarnproject.sketches._\nimport org.isarnproject.sketches.udaf._\nimport org.apache.spark.isarnproject.sketches.udt._\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<div class=\"ansiout\">notebook:1: error: object isarnproject is not a member of package org\nimport org.isarnproject.sketches._\n           ^\nnotebook:2: error: object isarnproject is not a member of package org\nimport org.isarnproject.sketches.udaf._\n           ^\nnotebook:3: error: object isarnproject is not a member of package org.apache.spark\nimport org.apache.spark.isarnproject.sketches.udt._\n                        ^\nnotebook:4: error: object isarnproject is not a member of package org\nimport org.isarnproject.sketches._\n           ^\nnotebook:5: error: object isarnproject is not a member of package org\nimport org.isarnproject.sketches.udaf._\n           ^\nnotebook:6: error: object isarnproject is not a member of package org.apache.spark\nimport org.apache.spark.isarnproject.sketches.udt._\n                        ^\n</div>","error":null,"workflows":[],"startTime":1511433398593,"submitTime":1511433412166,"finishTime":1511433398814,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4342d0ba-5a25-49d7-82c2-7e879b95eae4"},{"version":"CommandV1","origId":208436,"guid":"e72a0153-e477-49d2-afa7-beaf3aecb767","subtype":"command","commandType":"auto","position":0.6875,"command":"import scala.util.Random\nimport scala.util.Random._ \n\n// make a sample to produce a mixture of two normal RVs with standard deviation 1 but with different location or mean parameters\ndef myMixtureOf2Normals( normalLocation: Double, abnormalLocation: Double, normalWeight: Double, r: Random) : Double = {\n  val sample = if (r.nextDouble <= normalWeight) {r.nextGaussian+normalLocation } \n               else {r.nextGaussian + abnormalLocation} \n  return sample\n   }","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">import scala.util.Random\nimport scala.util.Random._\nmyMixtureOf2Normals: (normalLocation: Double, abnormalLocation: Double, normalWeight: Double, r: scala.util.Random)Double\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511433410740,"submitTime":1511433424325,"finishTime":1511433411003,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b09894c3-cfce-4870-a29d-ed6aab084f7c"},{"version":"CommandV1","origId":208486,"guid":"cdb21401-1dba-4fb4-862d-d17451dbb46f","subtype":"command","commandType":"auto","position":0.703125,"command":"%md\nHere is a quick overview of the simple mixture of two Normal or Gaussian random variables we will be simulating from.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1c34cf37-2303-4b55-9014-91d42377d83e"},{"version":"CommandV1","origId":208437,"guid":"c9ba3f22-a3b0-474d-bee2-098cd4ec0a99","subtype":"command","commandType":"auto","position":0.71875,"command":"val r = new Random(1L)\nprintln(myMixtureOf2Normals(1.0, 10.0, 0.99, r), myMixtureOf2Normals(1.0, 10.0, 0.99, r))\n// should always produce (0.5876430182311466,-0.34037937678788865) when seed = 1L","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">(0.5876430182311466,-0.34037937678788865)\nr: scala.util.Random = scala.util.Random@2cf4bcc9\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511433424623,"submitTime":1511433438098,"finishTime":1511433424972,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ef95a5ba-00e9-4456-94b6-02b4f4520c9d"},{"version":"CommandV1","origId":208438,"guid":"b72cbb79-5d2b-43cc-81ce-a5afaf01b8ce","subtype":"command","commandType":"auto","position":0.75,"command":"val r = new Random(12345L)\nval data = sc.parallelize(Vector.fill(10000){myMixtureOf2Normals(1.0, 10.0, 0.99, r)}).toDF.as[Double]","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">r: scala.util.Random = scala.util.Random@35499648\ndata: org.apache.spark.sql.Dataset[Double] = [value: double]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511433898100,"submitTime":1511433911656,"finishTime":1511433898589,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3f1aab44-e41c-4be8-8498-af94b3ff9b2b"},{"version":"CommandV1","origId":208439,"guid":"5313fb9d-f5dd-4583-81df-960b741e12ab","subtype":"command","commandType":"auto","position":0.8125,"command":"data.show(5)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+--------------------+\n|               value|\n+--------------------+\n|  0.2576188264990721|\n|-0.13149698512045327|\n|  1.4139063973267458|\n|-0.02383387596851...|\n|  0.7274784426774964|\n+--------------------+\nonly showing top 5 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511433901058,"submitTime":1511433914647,"finishTime":1511433901409,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5117c192-d1a7-4a7e-9adc-b363f088acad"},{"version":"CommandV1","origId":208440,"guid":"bebca5a5-2b55-4424-88a5-07ddb143d428","subtype":"command","commandType":"auto","position":0.875,"command":"display(data)","commandVersion":0,"state":"finished","results":{"type":"table","data":[[0.2576188264990721],[-0.13149698512045327],[1.4139063973267458],[-0.023833875968513496],[0.7274784426774964],[-1.0658630481235276],[0.746959841932221],[0.30477096247050206],[-0.06407620682061621],[1.8464307210258604],[2.0786529531264355],[0.685838993990332],[2.3056211153362485],[-0.7435548094085835],[-0.36946067155650786],[1.1178132434092503],[1.0672400098827672],[2.403799182291664],[2.7905949803662926],[2.3901047303648846],[2.2391322699010967],[0.7102559487906945],[-0.1875570296359037],[2.0036998039560725],[2.028162246705019],[-1.1084782237141253],[2.7320985336302965],[1.7953021498619885],[1.3332433299615185],[1.2842120504662247],[2.0013530061962186],[1.2596569236824775],[2.46479668588018],[-0.7015927727061835],[-0.510611131534981],[0.9403812557496112],[2.2306482205877427],[-0.29781070820511246],[4.107241990001628],[0.7420568724108764],[1.4652231673746594],[0.8793849318247119],[1.7671614106752898],[1.1995772213743607],[1.1351566745099897],[0.16150528245701323],[2.459849452657596],[1.0796739450956971],[-1.2079899446434252],[0.7019279468450133],[-0.025906759976580096],[1.025799236502406],[2.423754193708396],[1.0100073192180106],[1.2308412912433588],[2.2142939785873326],[9.639219241219372],[0.8964067897832677],[2.583753664296168],[1.7326439212827238],[0.7516388863094139],[0.8725633940449549],[-0.9407676766254014],[1.0542712925875175],[0.794535189312687],[0.5813794557982226],[0.4891368786472011],[2.3296394918008474],[1.425296303524094],[1.9276679925454094],[0.6178050147872097],[1.135269636375052],[1.3074367248762568],[0.6105659268751382],[1.7812955395572572],[-1.3547368916771827],[1.580412775615275],[1.5731144914401023],[-0.05725067553082108],[0.19580347035995105],[-0.021501122555202867],[1.5783579658949254],[1.371796305513024],[0.648919899258448],[-0.7875773550339058],[1.3233945353130716],[2.5685224032022127],[2.7331317575905807],[0.2521381731074053],[2.2408918489807905],[1.4924862197354933],[1.194657083531184],[0.7067352811215412],[0.027701718519244745],[0.279797547315617],[-0.21953266770586133],[1.1402931320647434],[0.904724947360263],[0.6677145203694429],[2.019977647420342],[-0.5190278662580565],[1.2549405940975034],[2.4267606721380233],[0.21858105660909444],[1.7701229392924476],[0.08326770280505069],[11.539205812425335],[0.612370126029857],[1.299073306785623],[2.6939073650678083],[2.5320627406973344],[0.02781337457744293],[0.3272489908510584],[-0.9427386544836929],[0.9364640268126377],[1.919225736153371],[0.38826998132506296],[-0.38655650387475715],[1.0433731216978939],[1.1500718903613745],[-0.3661280681150447],[0.883444064705467],[-0.9126173899348853],[0.3838114564837034],[0.7935189081504388],[1.928137393349846],[0.047092811957255676],[0.4684849965794433],[0.6745536358089256],[2.100439331925503],[1.0053957395581328],[1.1651633690031988],[1.1620631665685186],[0.5686294459758102],[0.054695916815372114],[0.3673527645506809],[1.1825682382920246],[2.590900208851957],[0.9580677196122074],[0.14058634902492095],[1.835715236145623],[1.0262133311924941],[2.3956360313411276],[-0.42622276533874537],[1.532866051791267],[0.33837135147986275],[0.5993221970260502],[0.5268259369536397],[0.9338448405595184],[1.5020324977316601],[-0.21633343524824378],[0.8387080531274844],[0.013278878139665884],[1.3291762275434373],[0.4837833343304839],[0.4918446444728072],[1.354678573169704],[0.2524216007924791],[0.5965026762340784],[2.000850130836448],[2.217169275505519],[0.6876140376775531],[1.0508210912529563],[1.65676102704454],[2.155047641017994],[1.0866488363653375],[1.0691398773308363],[0.6120836384011098],[0.24914099314834415],[2.8691481936548744],[0.7633561289177443],[1.4483835248568062],[2.6108825545691863],[1.2751533422561458],[1.0131179898567302],[0.46308679994249036],[0.7793261962344651],[1.1671037114122738],[2.143874895015684],[1.2344250301306705],[1.7402355361851662],[1.0396911219696297],[1.8089030277370215],[2.1235708326267533],[-0.33938888075466234],[1.090463095441436],[1.3101016219338661],[-0.6251493773996968],[1.7223308331307168],[1.0299845635585438],[1.962846046162154],[-0.018537289273720337],[0.7977254725466605],[-0.21427479370557312],[-1.6661289018266037],[1.144457447997468],[0.6503516296653954],[0.06581335919503728],[1.5478749815243467],[1.5497411627601851],[0.21791376679544772],[0.011291967445604012],[-0.30293144696154806],[0.4303254534802833],[1.5521304466388752],[2.2910302464408394],[0.4374695472538803],[0.4085186427342812],[-0.06531316403553289],[0.00639812257122474],[0.24840501087934996],[-1.021974709142702],[-0.09233941622902653],[0.41027379764960337],[1.864567223228712],[1.5393474896194466],[1.124907339909468],[2.0206475875654997],[-0.7058862229186389],[1.2344926787652002],[1.1406194673922239],[1.4084552620839659],[0.739931161380885],[0.29958396894640427],[-0.9379262816791101],[0.8259556704405835],[-0.3199802616466474],[1.9656420693625898],[0.8789984776053141],[2.4965042040211793],[1.714778861431627],[0.8669641143187272],[1.0757413525008879],[0.019658378382249264],[0.7165095911306543],[1.2251547673860115],[1.5869187313570912],[0.3928727449886338],[1.7722759642539445],[1.0350331272239843],[-1.4234008750858624],[0.6054572828043063],[0.3024585268617903],[0.029432999768948087],[0.9382472473173075],[2.11287419383702],[1.0876022969280528],[0.36548993902899596],[-2.005053653271253],[2.0367928918435894],[0.09261254419611942],[2.156248406806113],[-0.5295405173638772],[2.452318995994742],[0.8636413385915132],[0.31460938814139794],[-0.020257131370059023],[1.3213739526626505],[0.9463001869917488],[0.986171393681171],[0.12492672949874628],[0.9908400692267174],[1.0695623856543282],[1.0221220766637027],[2.8492797946693904],[1.0609742751901396],[1.6409490831011158],[1.5427085071446491],[1.7312859942989034],[1.2947069326850533],[0.3756138591369289],[1.4349084022701803],[0.37649651121290106],[0.7071860096564935],[1.5065536846394356],[0.15009861698305105],[0.035084734586888766],[1.9474563946729155],[9.423175513609095],[2.4871634825039015],[2.8472676324820685],[1.5999488876250578],[-0.2693864675719999],[1.6304414331783441],[0.39324529792831353],[0.4053253263569069],[0.9270234970247857],[1.4509585503273819],[0.8878267401905819],[1.1883024549090635],[1.0163155722641077],[-0.8003099498427713],[-0.9483216075980454],[1.0437451610964232],[2.19837214407137],[2.070797890483533],[1.2067096088561005],[0.5043809533024068],[0.3683130512293926],[1.0968506619209946],[-0.6602896123630477],[0.06829641971377687],[1.5578597945995134],[0.9822629073468155],[-0.7900771590527182],[1.1194124344742182],[1.1239015052468448],[1.9447892371838207],[2.0854603958592985],[0.17341117815802976],[1.5971150699056031],[0.35646629992342993],[1.8107324499508701],[3.463539114641669],[0.8683263379823365],[1.2642821462325637],[1.0099560176390794],[1.1930381560126895],[0.5433757598192581],[1.0213782743479625],[1.5049231054950472],[0.22101559200796428],[1.8743753391414122],[0.6050230742039573],[0.6939669876285336],[1.5379566524515602],[-0.6869579758877387],[-0.4823865565169676],[2.577388594447341],[0.9323745950234809],[-0.25032440836547454],[1.1141701800611599],[1.1577408343996396],[0.4735089125920344],[-1.5559289264558278],[-0.11080485473390023],[0.1536430200356127],[1.2851073161790278],[-0.9717966387140513],[0.4604981927819666],[0.4825924627571432],[1.8907687599342153],[1.5027092114554406],[0.4892227077808574],[2.2742380779964306],[0.00593203161994782],[0.9357077683018076],[1.6452901327178684],[2.5989481778450294],[3.1233030636814103],[2.14412876458466],[0.8645332371791754],[1.7396751361758789],[3.406726808728102],[0.27592904706426413],[-0.47288172874607715],[3.1581200247451022],[2.3502844371874003],[2.3604518998272104],[2.875582435906723],[1.802101533727158],[2.158082491464444],[-0.5284223682158626],[0.01929919317533868],[1.948485504832782],[0.49379467644006303],[0.33811694243690293],[1.332171769010618],[0.6994701270153069],[-0.413721820026016],[-1.5522089380783108],[2.161396170492705],[0.02333496950423164],[-0.10913840839170796],[1.1299228472291496],[2.4274358384176584],[1.9359707345891741],[3.487722218477596],[0.9990127159196325],[-1.0398429191328207],[0.3005833334887211],[-0.7334628100431295],[0.4835865602253189],[0.5246945471836175],[0.8469783573593253],[0.8359162587262456],[0.7772016511976113],[-0.39849883029666944],[1.8703097604547239],[2.682932324516024],[0.46996888720103236],[-0.07881388366585762],[2.1043645061434084],[0.6195230903468327],[-0.23170755440676594],[0.3918168388047796],[0.22086080450987344],[1.5182059037248368],[1.6442851975073318],[0.3979663516003099],[2.0531657985840983],[1.7928797637680196],[2.9329556976986013],[1.1087520027663345],[1.2115868818351045],[1.9163661519192294],[1.6917128257752045],[1.0095879056962782],[-0.13611276130309613],[2.2939319088848023],[1.0723690693732042],[2.1452154961792393],[0.7259078662420231],[2.6599123456452727],[0.2519779820647646],[2.1670014817546175],[0.10506784220981513],[2.018185302480656],[1.1665983169452525],[0.33284879429952463],[0.3531339079979545],[2.1004784012229245],[1.282680965361929],[1.2270715852857979],[0.858598096986649],[2.5040344133072407],[1.6541952933075013],[0.5329588210461834],[2.1274892552565134],[1.4668875035709574],[1.5382758818248594],[1.7428172106530586],[1.4727771685178368],[1.6023481462981235],[1.6577898477375492],[0.05892056976555449],[2.7754262543475523],[1.2200523142327606],[1.5903756890326521],[-1.49547625208842],[0.8523817097750093],[0.5057853403549346],[0.5683629007876065],[1.6479513379049497],[1.2148679515188867],[0.6222019509815193],[1.3255067306263184],[0.4983375954130155],[-0.08802709440091383],[0.13831985322805507],[-0.5487242466777436],[-0.32058114510029334],[1.8950590840214767],[1.0062190610750874],[-0.9934439161367286],[0.3671557383587293],[0.19986189782147756],[-0.49653972053539497],[0.6848255848767759],[1.5219606199148406],[1.455086538348867],[2.883109155648917],[1.8164694435868296],[0.6742710281863775],[0.5441958963393487],[1.0517397813571259],[0.8356831003190489],[0.8227690076487093],[1.4570119880481842],[-0.297581775651637],[-0.07206180041345078],[-0.8739444049086391],[2.2604530979343074],[2.3872947344763027],[3.3685772895980124],[2.013534739447639],[3.368251328412311],[0.8953451648220483],[0.09545874578601765],[0.7718477167244377],[1.0629106168204554],[0.5518190802821734],[2.9939679918505853],[1.8726021041818661],[0.2653885457840085],[1.9872672471653996],[-0.553166557898946],[1.5640591286122745],[2.52680639118602],[1.80742439492357],[2.1955997975781347],[0.5980285235875027],[-0.2658797956060317],[-0.49719135472382137],[1.180607461695498],[-0.10430878902480734],[0.823892717854915],[1.666382974377688],[3.748395965408928],[0.017921581120532326],[0.7499355222636435],[2.3386705969751205],[0.4946954139770775],[2.7985296324540565],[1.5356765186629966],[-0.33706316690289584],[-0.010348117718002703],[1.8281804903673144],[0.3172404416132534],[0.5893972598101371],[1.5326653373112777],[0.8539589801933155],[2.092892033666929],[0.6296940385798598],[8.99959554980265],[1.3401791716063445],[0.1625728478606363],[1.1023716302273685],[1.3244294511594552],[1.9717106308848458],[2.0935027130112918],[0.5540124632067691],[2.8390489237342758],[1.2584888592967522],[0.8378223664277132],[-0.03705953427792741],[-0.01125595126556278],[1.8829278782190024],[2.0192085492627894],[1.9386320044059204],[1.651530725699678],[0.8017983775095935],[-0.03514905095054344],[0.8155367784375459],[-0.5552596097915619],[1.8705605094803621],[10.174199861232976],[1.4536718681041976],[2.1062700105302996],[0.475922933272229],[1.0817390501017392],[2.2796321965842496],[0.23323897979804842],[1.0183686887164103],[-0.7554454183477253],[1.3019096488805835],[0.3374802783657267],[-0.5146418960525585],[-0.06048075364364469],[-0.05967451256405276],[1.233114706332717],[1.7406224225514757],[0.5238094364159517],[-0.04455639893554597],[0.6178805181179535],[-0.8510251471391128],[1.308052246786863],[0.3268079413606899],[-1.3025175142774486],[0.5320039005955481],[0.12387407754502777],[2.6101947374495293],[1.5224492462759098],[1.236244816444764],[1.4954016347946228],[0.5281503216531209],[0.8463329768741992],[1.1634091418265289],[1.7554480003839843],[1.8947204310797423],[0.7506627891160538],[-0.22423697078143956],[0.927732550621745],[2.784360564469151],[3.542787218532106],[0.432227325280209],[-0.9685039345572555],[1.610702352432787],[0.25225428913555614],[0.6318605835098334],[0.24784246074544614],[1.3125827737308564],[1.76027763070149],[1.604542790844651],[0.9391947816971199],[2.0113202394281036],[0.6833889165055331],[0.7828049531781445],[1.525206927196617],[0.4555978800663196],[2.158504891725925],[0.5497336163750275],[1.108152719515001],[2.229598024152815],[-0.30715895940514804],[-0.4963457195725012],[0.6317891104976874],[0.9404446092196193],[0.5824240745249956],[0.9522827784866549],[0.5747278460881767],[2.3228717276929878],[-0.12232857339482872],[10.442627838980057],[-0.9613909203767632],[2.360115785393865],[10.460772141286911],[-0.15127677602688205],[-0.7430747891693794],[1.1166522423684635],[0.9764807692690883],[1.0545546293851562],[1.4217770365949636],[0.8472372480230154],[1.9293695381886482],[1.224477650092793],[-0.576902390274286],[1.327683339856686],[2.3294636041468753],[1.0508125817809573],[0.6893104376174488],[0.25055576676244107],[0.9140712539798914],[1.9321126051060917],[0.26607474319516033],[1.5039430223830939],[0.024155724118245736],[2.9529975781223285],[2.525931295222416],[3.0184656376604537],[1.3686271300712956],[0.4798723250356388],[-1.008710689163618],[1.5701794389127253],[0.19978829057056857],[0.9240761354395062],[0.19521466746159932],[1.2744043502827374],[-0.5431195983133648],[0.1974591476352352],[0.7430949008871768],[0.8988725739330019],[1.6597416237841465],[1.7417674159020793],[2.4088293700031693],[1.143581580663996],[1.4082585153064164],[0.47069873985209143],[-1.1580364942293953],[1.0732710931019263],[1.5509982425379119],[1.7677585939234246],[-1.1941141421872046],[0.21105300062231513],[0.6529477393919702],[-0.34988928270936226],[0.5444265493743319],[2.251577733100331],[0.16913394323406872],[11.260505056159252],[0.7864958296725808],[1.091593382604825],[0.7471169918052949],[0.36078054843777674],[1.4284182466312578],[0.3641673471149427],[-1.0360349861808262],[0.38230293118496894],[1.8786902260733145],[-0.7366326071049587],[2.0194567072200393],[0.5111298609273971],[1.947809368661851],[2.628034116556221],[0.10041127309972464],[-0.9914516842653798],[0.42604512187698185],[0.8384351974667634],[0.9068232484596871],[0.5738655218292824],[1.9264618723701152],[1.5761237325879685],[1.626292107129501],[2.0849065606469557],[-0.11343769134229165],[0.1025048999056456],[1.053052626678512],[-0.24007907992011845],[0.1382201206040784],[1.8910416626489552],[2.8345096657368556],[2.583170811237836],[-0.3893702721041865],[1.3520108244803342],[-0.12593338576537327],[-0.9808107291023687],[1.4015364735733753],[1.695547239092475],[1.3489569585825598],[0.8360821611908951],[0.33683162328320115],[-1.260138655228694],[1.6662817407344905],[2.273339646058636],[2.1408145302279262],[1.1532315762716479],[0.792000410181182],[2.617286787875776],[0.1827575511422984],[-0.9059473522304451],[-0.31032406628601605],[1.487891710861818],[-0.19990519218780256],[1.5228011808161672],[1.091160988784999],[-0.5446290704848642],[0.5171720764854166],[1.3467504967289186],[0.5028941713981121],[1.6926426850928427],[2.737520065317047],[-0.6337974959768131],[1.8334664621031571],[1.1752071580242511],[1.7663153320810179],[-0.03287929610234186],[0.9776991082096643],[0.7572719681136401],[2.0252498233787533],[2.0549863976236282],[0.28876880002288263],[0.7795217487076926],[0.5157176523746317],[1.2531709070474009],[2.814127875620211],[1.1251332829763616],[-0.8742006368438211],[3.525681357968375],[-0.6125196383989251],[-1.028539893085076],[1.944129606903108],[0.4230304057405415],[0.6337892280346704],[-0.6826244579330205],[0.4137789790932437],[2.133348714505998],[1.6093325024482905],[0.1403062548964249],[0.9977662561095119],[1.6154705922157153],[1.5325103216966767],[1.6480988802470689],[1.5457471122768636],[0.9278397921261037],[0.5346075472347933],[-0.3366100838774142],[1.544130227285287],[0.36057447512773],[3.1190339889208265],[0.5642439359943654],[0.036032355486391277],[1.217657470850345],[1.3708372094771342],[1.6204088991501409],[1.8068635367597905],[0.6836982699156782],[2.416660438805482],[1.435090083978466],[-0.6957004139189842],[2.796032650243188],[1.263889553950158],[-0.24234558620465552],[0.4126133154078948],[0.48194295180327873],[-0.04239311593641104],[2.131857833197308],[-0.15570995063363013],[0.7854482141700682],[1.8430551242641047],[-0.30696087051905785],[1.0556256557163515],[0.6908168936931991],[0.8953437823585769],[1.3572533765348747],[0.11398684036386209],[1.6619698080507603],[1.665250946590736],[0.8975920127377776],[2.2911345789955044],[0.9992259266914368],[-0.4298332988614957],[2.856688086679865],[9.905282503779972],[0.4160546198968119],[1.3074428261508197],[0.12330796113292308],[-0.08208866462136077],[0.43041154874660903],[-0.26805738332282525],[0.24248755197881344],[0.4672444655763044],[0.7429087035211764],[1.4882911024620438],[2.444968952436855],[-0.8041993598535895],[1.208622081250596],[0.08898983802592564],[1.8374497912460765],[2.770255925243865],[-0.8251005403922271],[-0.31615303993603194],[-0.06680911706266524],[-0.5060055961402281],[-0.10993772270902569],[-1.7858062514118545],[0.38124537958478155],[3.343016296304274],[3.200888498150916],[1.6539706630340567],[1.0358929561627934],[0.7349519148503848],[-0.5558335228136968],[0.8033111443298455],[1.0199590698825889],[1.3413895470645456],[1.7812455522573842],[0.5566880617934874],[2.3484161679464695],[1.1721286969240714],[1.985537497377007],[0.5028248990186489],[1.126187102927933],[1.098065463397298],[1.0022339510207767],[0.6524600640259166],[0.9129989416782233],[-0.04072646036731209],[-0.4997127716196892],[3.427010275934218],[-1.0592305386912666],[0.2158285556706534],[0.514825837851193],[1.8458680276815647],[0.6489366461843191],[1.4264428618420764],[1.8853463069064655],[0.9353141249181827],[-0.768007390555169],[-0.2825922690641738],[-0.11644476731169018],[1.5527313352517889],[1.361096472043486],[1.595550522072551],[0.7928138591830576],[2.4014413844006057],[0.9357181425237647],[1.0321537115844546],[1.017467185134316],[0.7544499732365095],[3.2914090464924084],[-0.30115720611734975],[1.1053894805207805],[0.24699783640458162],[-0.5754508908317295],[-0.7653405793793806],[2.551152606418246],[2.002335507569091],[2.873768745568216],[2.4779420958282303],[0.9919751607449626],[0.26553883660973165],[1.5810534545434005],[0.4363020620988478],[0.4208482016324523],[1.801337254210524],[0.7282927824660008],[2.370482819434382],[2.2689908454614955],[1.8992484787681332],[1.1345675892485614],[0.6800326573416028],[0.8256537442772758],[0.8771603935244864],[-1.0434719594542736],[0.8516519961407986],[2.185092193636852],[0.20653003088418287],[1.0609626373137258],[1.6312654872266645],[-0.10993816750885665],[2.511242528714717],[0.44520543525892353],[1.3189873412126392],[1.4382931017594118],[1.2450171964918337],[0.1075552521924854],[1.640701165992256],[1.5615637324174714],[0.8670086589057957],[-0.5321458051266028],[-0.0030490144428005905],[1.155437571970963],[2.0317104875172864],[0.10380445370650004],[1.5267461286865376],[9.102639076417908],[0.11175944316229147],[2.605816329847464],[-0.31757356268646797],[1.938296237870294],[2.623630455719459],[-0.17930511974208407],[0.22653773264797206],[0.7738024281145457],[0.8303926211791302],[3.8144763777667077],[0.2892406024466241],[0.279787632770216],[1.9176201484359812],[2.508246019756138],[1.4202553258576178],[0.8725425712951034],[2.590931954493854],[-0.6083285430052974],[0.3155829148992413],[0.9716424879068793],[-0.01933633148749392],[0.416940875088748],[0.9075871303206937],[-0.18322964916243012],[0.49834578143129415],[1.1523265845585398],[0.16862160117832925],[0.22112613360304012],[0.8542929631268784],[2.1065267442021933],[0.08716744674485033],[1.8741906276937679],[-0.8800017423117874],[0.985677419800145],[1.7814889560835554],[2.110674163627958],[0.6068631467692929],[2.010892494531559],[0.182773938051226],[0.9818670611842848],[1.5106418585391912],[0.27457120930224954],[3.131668044566185],[1.426032519824096],[2.756853957923013],[-0.08337312101971261],[-1.2512930084219307],[1.994731189314644],[1.5010954171753113],[1.6160885909571072],[0.997576086981748],[2.290454085433865],[1.5282322334484473],[0.9423457650293142],[-0.6929312351526271],[1.2117261668663954],[1.04304142983433],[0.09191415024846095],[-0.1856239446441006],[1.6459370551496064],[1.5887750906532614],[0.5153567867710697],[-0.5317451085692393],[1.2883518590500194],[-0.7231095994748975],[0.14806012859804774],[-1.1482141379213884],[-0.3327423570689081],[1.7898218176905512],[0.9371146998642512],[0.3889248981364597],[1.2257589408359904],[0.05216316163565138],[-0.032779385011159734],[0.9614097586524999],[4.39269909553782],[-0.291144125748688],[1.2868205085801738],[0.1096371776044478],[1.0358811391307199],[0.05805861249302269],[0.8985406306915447],[0.3622980657724947],[7.799859986587844],[-0.32465244606923727],[-0.11398647870671152],[2.507893114732872],[1.064845371081416],[0.5365179326980457],[1.7351202994151347],[0.8109120435203592],[0.3353686164143178],[0.4575130713351897],[1.544495758400612]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"value","type":"\"double\"","metadata":"{}"}],"overflow":true,"aggData":[[-3.171187928231144,5],[-2.378390946173358,37],[-1.585593964115572,341],[-0.792796982057786,1242],[0.0,2559],[0.792796982057786,2998],[1.585593964115572,1844],[2.378390946173358,702],[3.171187928231144,142],[3.9639849102889304,12],[7.135172838520075,3],[7.927969820577861,12],[8.720766802635646,26],[9.513563784693432,36],[10.306360766751219,27],[11.099157748809004,12],[11.891954730866791,1],[12.684751712924577,1]],"aggSchema":[{"name":"__DATABRICKS_INTERNAL_HISTOGRAM_BIN_FIELD__","type":"\"double\"","metadata":"{\"aggRole\":\"groupBy\"}"},{"name":"value","type":"\"double\"","metadata":"{\"aggRole\":\"agg\"}"}],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"histogram","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511433904193,"submitTime":1511433917756,"finishTime":1511433905265,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"histogram","width":"476","height":"340","xColumns":[],"yColumns":["value"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"histogram":[{"key":"bins","value":"20"}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1f320397-6c04-4790-8fba-d788838e9728"},{"version":"CommandV1","origId":208487,"guid":"12ae775d-836c-4777-8409-d72c0052d73e","subtype":"command","commandType":"auto","position":0.90625,"command":"%md\nLet's t-digest this `data` using a user-defined function `udaf` evaluated below.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"68fe3d52-a8d7-453d-b528-6efc1c6b503b"},{"version":"CommandV1","origId":208441,"guid":"7af1da6f-833a-43b3-8174-ddbdec0e2265","subtype":"command","commandType":"auto","position":0.9375,"command":"val udaf = tdigestUDAF[Double].delta(0.2)\n                              //.maxDiscrete(25) // an additional optimisation with bins","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">udaf: org.isarnproject.sketches.udaf.TDigestUDAF[Double] = TDigestUDAF(0.2,0)\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511433909164,"submitTime":1511433922752,"finishTime":1511433909469,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6af351e2-63c9-43ef-8836-da268ce04148"},{"version":"CommandV1","origId":208488,"guid":"1f6eb34e-ea49-4990-a623-0d6a236378df","subtype":"command","commandType":"auto","position":0.953125,"command":"%md\nWe can `agg` or aggregate the `data` DataFrame's `value` column of `Double`s that contain our data as follows.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"68e5254a-1241-44bb-a9de-4a2f1177f5eb"},{"version":"CommandV1","origId":208442,"guid":"ac8ab16e-af5f-451e-848c-90341b690e0c","subtype":"command","commandType":"auto","position":0.96875,"command":"val agg = data.agg(udaf($\"value\"))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">agg: org.apache.spark.sql.DataFrame = [tdigestudaf(value): tdigest]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511433913336,"submitTime":1511433926919,"finishTime":1511433913834,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ef4908d1-60cb-4791-b9f6-ee75d217a0da"},{"version":"CommandV1","origId":208489,"guid":"98e15c6f-ebd9-402d-9279-5bcf85208795","subtype":"command","commandType":"auto","position":0.9765625,"command":"%md\nNext, let's get the t-digest of the aggregation as `td`.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ead539b9-1bfc-4728-8775-078d6c1f8c9a"},{"version":"CommandV1","origId":208444,"guid":"96dec044-c4db-42b1-8e34-329256dbe32a","subtype":"command","commandType":"auto","position":0.984375,"command":"val td = agg.first.getAs[TDigestSQL](0).tdigest // t-digest","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">td: org.isarnproject.sketches.TDigest = TDigest(0.2,0,137,TDigestMap(-2.795387521721169 -&gt; (1.0, 1.0), -2.5827462010549587 -&gt; (1.0, 2.0), -2.5483614528075127 -&gt; (1.0, 3.0), -2.477169648218326 -&gt; (1.0, 4.0), -2.3989148382735106 -&gt; (1.0, 5.0), -2.3621428788859387 -&gt; (1.0, 6.0), -2.3148374687684097 -&gt; (0.6599375020366591, 6.659937502036659), -2.3125673391578063 -&gt; (1.3301295134267586, 7.990067015463417), -2.2869139467179167 -&gt; (1.7716040048548714, 9.761671020318289), -2.2636971919621813 -&gt; (0.23832897968171096, 10.0), -2.0993694077900718 -&gt; (0.9679652111755495, 10.96796521117555), -2.0374280877514073 -&gt; (0.8036200489928786, 11.771585260168429), -2.008628128720943 -&gt; (2.204295395214974, 13.975880655383403), -1.9799895567671855 -&gt; (0.6717906689718269, 14.64767132435523), -1.9635404957133342 -&gt; (2.8815532225111813, 17.52922454686641), -1.899364102428411 -&gt; (3.5047976358149664, 21.034022182681376), -1.8935452617011608 -&gt; (0.9659778173186226, 22.0), -1.7834073726649236 -&gt; (4.0, 26.0), -1.6748447233354293 -&gt; (4.368698519491373, 30.368698519491375), -1.64555306421358 -&gt; (3.631301480508627, 34.0), -1.6091296440532281 -&gt; (7.0, 41.0), -1.581533783623044 -&gt; (4.0, 45.0), -1.5483981038434067 -&gt; (6.560204096834605, 51.5602040968346), -1.5120146330181543 -&gt; (7.62421745259823, 59.184421549432834), -1.4717418407937775 -&gt; (8.815578450567166, 68.0), -1.4063760775866394 -&gt; (12.800839656820326, 80.80083965682033), -1.3448698733594848 -&gt; (16.023860049556692, 96.82469970637702), -1.2893622489786558 -&gt; (9.858644542502482, 106.68334424887951), -1.2577068775157296 -&gt; (16.550833463227963, 123.23417771210747), -1.2297589662542086 -&gt; (5.463042043098952, 128.69721975520642), -1.2060997038692673 -&gt; (20.302780244793585, 149.0), -1.1491161624092898 -&gt; (25.76798602053494, 174.76798602053495), -1.1135641229645985 -&gt; (12.423005143999912, 187.19099116453486), -1.0685344414176143 -&gt; (26.783120524339587, 213.97411168887444), -1.0323848325430838 -&gt; (16.63549107142857, 230.609602760303), -0.9866222212073446 -&gt; (23.788016803291637, 254.39761956359465), -0.9497461655620497 -&gt; (29.08674669226949, 283.48436625586413), -0.9118490862735472 -&gt; (20.59159498877623, 304.0759612446404), -0.8694163862755389 -&gt; (33.123564105489756, 337.19952535013016), -0.818736730934315 -&gt; (52.1563476029216, 389.35587295305174), -0.7479408556355343 -&gt; (61.925127078567286, 451.28100003161904), -0.6867731815523207 -&gt; (48.07685810509796, 499.357858136717), -0.6281811941110975 -&gt; (70.84176189108744, 570.1996200278045), -0.5734204802885597 -&gt; (60.73927341849002, 630.9388934462945), -0.5253935153589147 -&gt; (60.895384887279, 691.8342783335735), -0.4727181407508696 -&gt; (84.65346692284842, 776.4877452564219), -0.4183225759962036 -&gt; (57.14194932251596, 833.6296945789379), -0.3732605516445849 -&gt; (71.21267638308262, 904.8423709620206), -0.32582691117268947 -&gt; (92.32940794821484, 997.1717789102354), -0.27259472416178243 -&gt; (91.70747316618615, 1088.8792520764216), -0.2230954128597663 -&gt; (84.58384636648559, 1173.4630984429073), -0.15524161077336388 -&gt; (156.72720326513735, 1330.1903017080447), -0.08845206643515205 -&gt; (147.19847600015095, 1477.3887777081957), -0.02085650418093665 -&gt; (176.55537984353873, 1653.9441575517344), 0.03893266279461198 -&gt; (155.75159617985264, 1809.695753731587), 0.09938107165485015 -&gt; (163.4762453741249, 1973.1719991057118), 0.1526216239516141 -&gt; (170.59860607858832, 2143.7706051843), 0.21453126905557823 -&gt; (176.55571400826986, 2320.32631919257), 0.2834394728937001 -&gt; (213.57358132621525, 2533.899900518785), 0.36393016087166596 -&gt; (279.12323268717813, 2813.0231332059634), 0.45679788946397837 -&gt; (278.0902421901438, 3091.113375396107), 0.5330855831009225 -&gt; (227.50480956676324, 3318.61818496287), 0.5968511484840918 -&gt; (275.63904126007793, 3594.2572262229482), 0.6786380701725078 -&gt; (326.55464408030315, 3920.8118703032515), 0.7625053055192722 -&gt; (295.0568528562476, 4215.8687231594995), 0.8388772354285464 -&gt; (258.41153144878285, 4474.280254608282), 0.9070689204546466 -&gt; (326.76808910266044, 4801.048343710942), 1.0018427518639939 -&gt; (422.5468200238942, 5223.595163734836), 1.1017961944715824 -&gt; (409.87709458864884, 5633.472258323485), 1.206398134684977 -&gt; (357.8525985596794, 5991.324856883165), 1.3011458883945075 -&gt; (333.74799203938045, 6325.072848922546), 1.390097192526568 -&gt; (359.4001599043703, 6684.473008826916), 1.4673753974641968 -&gt; (194.71796878411135, 6879.190977611028), 1.530450897938683 -&gt; (238.7420465487473, 7117.933024159775), 1.5912144507660058 -&gt; (168.87739950717233, 7286.810423666948), 1.6545017805538234 -&gt; (211.16935108645868, 7497.979774753407), 1.7155992131858704 -&gt; (157.03121148726777, 7655.010986240674), 1.7781269703413782 -&gt; (188.15654117816, 7843.167527418835), 1.848071347060917 -&gt; (191.27664623192337, 8034.444173650758), 1.9254472410816295 -&gt; (226.97702297155027, 8261.421196622308), 1.9969160162227046 -&gt; (148.22756031130024, 8409.648756933608), 2.0714766462751193 -&gt; (185.44546357626868, 8595.094220509876), 2.158990362568614 -&gt; (151.4954386893494, 8746.589659199226), 2.243905017040895 -&gt; (127.47207866240211, 8874.061737861628), 2.3175984415467035 -&gt; (88.04157056026982, 8962.103308421898), 2.371803768181736 -&gt; (107.28246020996545, 9069.385768631864), 2.444709595910291 -&gt; (97.69039902579638, 9167.07616765766), 2.5211122778774384 -&gt; (96.8891914206513, 9263.965359078311), 2.5983170298888094 -&gt; (88.80246155925472, 9352.767820637566), 2.6555245160633634 -&gt; (52.72532220594397, 9405.49314284351), 2.7096416373276084 -&gt; (33.382789065635464, 9438.875931909146), 2.749125370761872 -&gt; (61.62614292495636, 9500.502074834103), 2.8044848896450474 -&gt; (49.39991763386941, 9549.901992467972), 2.875888748759476 -&gt; (65.78546774441155, 9615.687460212384), 2.971742780087539 -&gt; (51.68302203426054, 9667.370482246644), 3.0668184247986834 -&gt; (45.939729735298556, 9713.310211981943), 3.1487058684289755 -&gt; (17.546947507400326, 9730.857159489344), 3.218035693080918 -&gt; (34.167423370384746, 9765.024582859729), 3.293985917642407 -&gt; (18.39114989602229, 9783.415732755751), 3.365796545976432 -&gt; (7.343282617430643, 9790.759015373182), 3.423680137621862 -&gt; (30.285094984710557, 9821.044110357892), 3.5361960382135766 -&gt; (16.022107226715036, 9837.066217584608), 3.708086046825087 -&gt; (28.25855387318669, 9865.324771457796), 3.8172837056780202 -&gt; (0.047583335239924196, 9865.372354793035), 4.128936063148887 -&gt; (16.62764520696945, 9882.000000000004), 8.015570304845104 -&gt; (7.0, 9889.000000000004), 8.744451287156746 -&gt; (13.0, 9902.000000000004), 9.25232140353154 -&gt; (16.0, 9918.000000000004), 9.530110739378491 -&gt; (12.21860057292937, 9930.218600572933), 9.764762794436761 -&gt; (9.854383912374931, 9940.072984485307), 9.817748101058383 -&gt; (0.9270155146956984, 9941.000000000002), 9.897390259617893 -&gt; (3.0, 9944.000000000002), 10.013981101637214 -&gt; (5.806895868211391, 9949.806895868212), 10.089622842201312 -&gt; (6.193104131788609, 9956.000000000002), 10.23781043312598 -&gt; (1.0, 9957.000000000002), 10.328279750526765 -&gt; (6.938509789117737, 9963.938509789119), 10.431120116662031 -&gt; (5.061490210882263, 9969.000000000002), 10.466786830859942 -&gt; (4.0, 9973.000000000002), 10.56075722636066 -&gt; (2.0, 9975.000000000002), 10.722439204327575 -&gt; (4.0, 9979.000000000002), 10.797997919393662 -&gt; (1.0, 9980.000000000002), 10.914286987473139 -&gt; (3.0, 9983.000000000002), 11.029145551894192 -&gt; (3.0, 9986.000000000002), 11.15766037328291 -&gt; (0.5600152717057256, 9986.560015271707), 11.160788156092288 -&gt; (0.003690029453065069, 9986.56370530116), 11.160856304869647 -&gt; (2.4384456998649116, 9989.002151001025), 11.191788227887427 -&gt; (0.9978489989762978, 9990.000000000002), 11.260505056159252 -&gt; (1.0, 9991.000000000002), 11.377434107003292 -&gt; (1.0, 9992.000000000002), 11.443715653916865 -&gt; (1.0, 9993.000000000002), 11.5156156303936 -&gt; (1.0, 9994.000000000002), 11.539205812425335 -&gt; (1.0, 9995.000000000002), 11.569770306228012 -&gt; (1.0, 9996.000000000002), 11.700351579256392 -&gt; (1.0, 9997.000000000002), 11.75051572042176 -&gt; (1.0, 9998.000000000002), 12.004778690455263 -&gt; (1.0, 9999.000000000002), 13.06055211943455 -&gt; (1.0, 10000.000000000002)))\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511433915483,"submitTime":1511433929072,"finishTime":1511433916695,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9f93f33e-657e-4c75-b810-775c0b962672"},{"version":"CommandV1","origId":208490,"guid":"6205d264-4b6a-4a7b-b2d0-8604e2bb41f0","subtype":"command","commandType":"auto","position":0.98828125,"command":"%md\nWe can evaluate the t-digest `td` as a cummulative distribution function or CDF at `x` via the `.cdf(x)` method.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b72b534f-66ae-4981-9afa-fa7c50a1b43e"},{"version":"CommandV1","origId":208445,"guid":"039e8439-93b6-4e65-91c5-1477ad589c2e","subtype":"command","commandType":"auto","position":0.9921875,"command":"td.cdf(1.0)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">res22: Double = 0.5005037034803238\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511433921332,"submitTime":1511433934888,"finishTime":1511433921657,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6665d434-567e-4cb5-9442-0f9a6401bfdc"},{"version":"CommandV1","origId":208491,"guid":"5653fc90-5ef5-4106-ad20-68dafb1817ad","subtype":"command","commandType":"auto","position":0.9951171875,"command":"%md\nWe can also get the inverse CDF at any `u` in the unit interval to get quantiles as follows.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"cc0369c2-433a-4239-9b7e-5451c8125278"},{"version":"CommandV1","origId":208446,"guid":"c52b1a30-5766-44a9-aaf8-f068fd45c218","subtype":"command","commandType":"auto","position":0.998046875,"command":"val cutOff = td.cdfInverse(0.99)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">cutOff: Double = 9.072447729196986\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<div class=\"ansiout\">&lt;console&gt;:54: error: not found: value td1\n       val cutOff = td1.cdfInverse(0.99)\n                    ^\n</div>","error":null,"workflows":[],"startTime":1511433953528,"submitTime":1511433967113,"finishTime":1511433953847,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"55dcdc46-68fb-40c3-a777-6b41940e075d"},{"version":"CommandV1","origId":208447,"guid":"82599d7d-f8ae-468f-92cc-461043cb0cfb","subtype":"command","commandType":"auto","position":0.998291015625,"command":"%md\nLet's flag those points that cross the threshold determine dby the `cutOff`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a198bb21-5a93-4045-a885-39a673923e2a"},{"version":"CommandV1","origId":208448,"guid":"af40610e-7d40-43dd-aff0-69b2bb2df78f","subtype":"command","commandType":"auto","position":0.99853515625,"command":"val dataFlagged = data.withColumn(\"anomalous\",$\"value\">cutOff)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">dataFlagged: org.apache.spark.sql.DataFrame = [value: double, anomalous: boolean]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511433965770,"submitTime":1511433979298,"finishTime":1511433966278,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"dc8df5dc-3f5c-40d4-a836-36e96ff0da14"},{"version":"CommandV1","origId":208492,"guid":"c4303701-5e3e-491b-93c4-a854affc434f","subtype":"command","commandType":"auto","position":0.998779296875,"command":"%md\nLet's show and display the anomalous points.\n\nWe are not interested in word-wars over anomalies and outliers here (at the end of the day we are really only interested in the real problem that these arithmetic and syntactic expressions will be used to solve, such as,:\n\n* keep a washing machine running longer by shutting it down before it will break down (predictive maintenance)\n* keep a network from being attacked by bots/malware/etc by flagging any unusual events worth escalating to the network security opes teams (without annoying them constantly!)\n* etc.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"47377895-67f3-422e-8489-ed7d81df8586"},{"version":"CommandV1","origId":208449,"guid":"382f0699-93df-447e-bd26-720bdc129fbb","subtype":"command","commandType":"auto","position":0.9990234375,"command":"data.withColumn(\"anomalous\",$\"value\">cutOff).filter(\"anomalous\").show(5)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+------------------+---------+\n|             value|anomalous|\n+------------------+---------+\n| 9.639219241219372|     true|\n|11.539205812425335|     true|\n| 9.423175513609095|     true|\n|10.174199861232976|     true|\n|10.442627838980057|     true|\n+------------------+---------+\nonly showing top 5 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<div class=\"ansiout\">notebook:1: error: value === is not a member of String\ndata.withColumn(&quot;anomalous&quot;,$&quot;value&quot;&gt;cutOff).filter(&quot;anomalous&quot;===true)\n                                                               ^\n</div>","error":null,"workflows":[],"startTime":1511433970425,"submitTime":1511433984016,"finishTime":1511433971029,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6a82d415-8a59-49f7-a4b3-be46fad7736b"},{"version":"CommandV1","origId":208450,"guid":"5ac6ccdf-b936-42d1-87e4-a15ed41347e9","subtype":"command","commandType":"auto","position":1.9990234375,"command":"display(dataFlagged)","commandVersion":0,"state":"finished","results":{"type":"table","data":[[0.2576188264990721,false],[-0.13149698512045327,false],[1.4139063973267458,false],[-0.023833875968513496,false],[0.7274784426774964,false],[-1.0658630481235276,false],[0.746959841932221,false],[0.30477096247050206,false],[-0.06407620682061621,false],[1.8464307210258604,false],[2.0786529531264355,false],[0.685838993990332,false],[2.3056211153362485,false],[-0.7435548094085835,false],[-0.36946067155650786,false],[1.1178132434092503,false],[1.0672400098827672,false],[2.403799182291664,false],[2.7905949803662926,false],[2.3901047303648846,false],[2.2391322699010967,false],[0.7102559487906945,false],[-0.1875570296359037,false],[2.0036998039560725,false],[2.028162246705019,false],[-1.1084782237141253,false],[2.7320985336302965,false],[1.7953021498619885,false],[1.3332433299615185,false],[1.2842120504662247,false],[2.0013530061962186,false],[1.2596569236824775,false],[2.46479668588018,false],[-0.7015927727061835,false],[-0.510611131534981,false],[0.9403812557496112,false],[2.2306482205877427,false],[-0.29781070820511246,false],[4.107241990001628,false],[0.7420568724108764,false],[1.4652231673746594,false],[0.8793849318247119,false],[1.7671614106752898,false],[1.1995772213743607,false],[1.1351566745099897,false],[0.16150528245701323,false],[2.459849452657596,false],[1.0796739450956971,false],[-1.2079899446434252,false],[0.7019279468450133,false],[-0.025906759976580096,false],[1.025799236502406,false],[2.423754193708396,false],[1.0100073192180106,false],[1.2308412912433588,false],[2.2142939785873326,false],[9.639219241219372,true],[0.8964067897832677,false],[2.583753664296168,false],[1.7326439212827238,false],[0.7516388863094139,false],[0.8725633940449549,false],[-0.9407676766254014,false],[1.0542712925875175,false],[0.794535189312687,false],[0.5813794557982226,false],[0.4891368786472011,false],[2.3296394918008474,false],[1.425296303524094,false],[1.9276679925454094,false],[0.6178050147872097,false],[1.135269636375052,false],[1.3074367248762568,false],[0.6105659268751382,false],[1.7812955395572572,false],[-1.3547368916771827,false],[1.580412775615275,false],[1.5731144914401023,false],[-0.05725067553082108,false],[0.19580347035995105,false],[-0.021501122555202867,false],[1.5783579658949254,false],[1.371796305513024,false],[0.648919899258448,false],[-0.7875773550339058,false],[1.3233945353130716,false],[2.5685224032022127,false],[2.7331317575905807,false],[0.2521381731074053,false],[2.2408918489807905,false],[1.4924862197354933,false],[1.194657083531184,false],[0.7067352811215412,false],[0.027701718519244745,false],[0.279797547315617,false],[-0.21953266770586133,false],[1.1402931320647434,false],[0.904724947360263,false],[0.6677145203694429,false],[2.019977647420342,false],[-0.5190278662580565,false],[1.2549405940975034,false],[2.4267606721380233,false],[0.21858105660909444,false],[1.7701229392924476,false],[0.08326770280505069,false],[11.539205812425335,true],[0.612370126029857,false],[1.299073306785623,false],[2.6939073650678083,false],[2.5320627406973344,false],[0.02781337457744293,false],[0.3272489908510584,false],[-0.9427386544836929,false],[0.9364640268126377,false],[1.919225736153371,false],[0.38826998132506296,false],[-0.38655650387475715,false],[1.0433731216978939,false],[1.1500718903613745,false],[-0.3661280681150447,false],[0.883444064705467,false],[-0.9126173899348853,false],[0.3838114564837034,false],[0.7935189081504388,false],[1.928137393349846,false],[0.047092811957255676,false],[0.4684849965794433,false],[0.6745536358089256,false],[2.100439331925503,false],[1.0053957395581328,false],[1.1651633690031988,false],[1.1620631665685186,false],[0.5686294459758102,false],[0.054695916815372114,false],[0.3673527645506809,false],[1.1825682382920246,false],[2.590900208851957,false],[0.9580677196122074,false],[0.14058634902492095,false],[1.835715236145623,false],[1.0262133311924941,false],[2.3956360313411276,false],[-0.42622276533874537,false],[1.532866051791267,false],[0.33837135147986275,false],[0.5993221970260502,false],[0.5268259369536397,false],[0.9338448405595184,false],[1.5020324977316601,false],[-0.21633343524824378,false],[0.8387080531274844,false],[0.013278878139665884,false],[1.3291762275434373,false],[0.4837833343304839,false],[0.4918446444728072,false],[1.354678573169704,false],[0.2524216007924791,false],[0.5965026762340784,false],[2.000850130836448,false],[2.217169275505519,false],[0.6876140376775531,false],[1.0508210912529563,false],[1.65676102704454,false],[2.155047641017994,false],[1.0866488363653375,false],[1.0691398773308363,false],[0.6120836384011098,false],[0.24914099314834415,false],[2.8691481936548744,false],[0.7633561289177443,false],[1.4483835248568062,false],[2.6108825545691863,false],[1.2751533422561458,false],[1.0131179898567302,false],[0.46308679994249036,false],[0.7793261962344651,false],[1.1671037114122738,false],[2.143874895015684,false],[1.2344250301306705,false],[1.7402355361851662,false],[1.0396911219696297,false],[1.8089030277370215,false],[2.1235708326267533,false],[-0.33938888075466234,false],[1.090463095441436,false],[1.3101016219338661,false],[-0.6251493773996968,false],[1.7223308331307168,false],[1.0299845635585438,false],[1.962846046162154,false],[-0.018537289273720337,false],[0.7977254725466605,false],[-0.21427479370557312,false],[-1.6661289018266037,false],[1.144457447997468,false],[0.6503516296653954,false],[0.06581335919503728,false],[1.5478749815243467,false],[1.5497411627601851,false],[0.21791376679544772,false],[0.011291967445604012,false],[-0.30293144696154806,false],[0.4303254534802833,false],[1.5521304466388752,false],[2.2910302464408394,false],[0.4374695472538803,false],[0.4085186427342812,false],[-0.06531316403553289,false],[0.00639812257122474,false],[0.24840501087934996,false],[-1.021974709142702,false],[-0.09233941622902653,false],[0.41027379764960337,false],[1.864567223228712,false],[1.5393474896194466,false],[1.124907339909468,false],[2.0206475875654997,false],[-0.7058862229186389,false],[1.2344926787652002,false],[1.1406194673922239,false],[1.4084552620839659,false],[0.739931161380885,false],[0.29958396894640427,false],[-0.9379262816791101,false],[0.8259556704405835,false],[-0.3199802616466474,false],[1.9656420693625898,false],[0.8789984776053141,false],[2.4965042040211793,false],[1.714778861431627,false],[0.8669641143187272,false],[1.0757413525008879,false],[0.019658378382249264,false],[0.7165095911306543,false],[1.2251547673860115,false],[1.5869187313570912,false],[0.3928727449886338,false],[1.7722759642539445,false],[1.0350331272239843,false],[-1.4234008750858624,false],[0.6054572828043063,false],[0.3024585268617903,false],[0.029432999768948087,false],[0.9382472473173075,false],[2.11287419383702,false],[1.0876022969280528,false],[0.36548993902899596,false],[-2.005053653271253,false],[2.0367928918435894,false],[0.09261254419611942,false],[2.156248406806113,false],[-0.5295405173638772,false],[2.452318995994742,false],[0.8636413385915132,false],[0.31460938814139794,false],[-0.020257131370059023,false],[1.3213739526626505,false],[0.9463001869917488,false],[0.986171393681171,false],[0.12492672949874628,false],[0.9908400692267174,false],[1.0695623856543282,false],[1.0221220766637027,false],[2.8492797946693904,false],[1.0609742751901396,false],[1.6409490831011158,false],[1.5427085071446491,false],[1.7312859942989034,false],[1.2947069326850533,false],[0.3756138591369289,false],[1.4349084022701803,false],[0.37649651121290106,false],[0.7071860096564935,false],[1.5065536846394356,false],[0.15009861698305105,false],[0.035084734586888766,false],[1.9474563946729155,false],[9.423175513609095,true],[2.4871634825039015,false],[2.8472676324820685,false],[1.5999488876250578,false],[-0.2693864675719999,false],[1.6304414331783441,false],[0.39324529792831353,false],[0.4053253263569069,false],[0.9270234970247857,false],[1.4509585503273819,false],[0.8878267401905819,false],[1.1883024549090635,false],[1.0163155722641077,false],[-0.8003099498427713,false],[-0.9483216075980454,false],[1.0437451610964232,false],[2.19837214407137,false],[2.070797890483533,false],[1.2067096088561005,false],[0.5043809533024068,false],[0.3683130512293926,false],[1.0968506619209946,false],[-0.6602896123630477,false],[0.06829641971377687,false],[1.5578597945995134,false],[0.9822629073468155,false],[-0.7900771590527182,false],[1.1194124344742182,false],[1.1239015052468448,false],[1.9447892371838207,false],[2.0854603958592985,false],[0.17341117815802976,false],[1.5971150699056031,false],[0.35646629992342993,false],[1.8107324499508701,false],[3.463539114641669,false],[0.8683263379823365,false],[1.2642821462325637,false],[1.0099560176390794,false],[1.1930381560126895,false],[0.5433757598192581,false],[1.0213782743479625,false],[1.5049231054950472,false],[0.22101559200796428,false],[1.8743753391414122,false],[0.6050230742039573,false],[0.6939669876285336,false],[1.5379566524515602,false],[-0.6869579758877387,false],[-0.4823865565169676,false],[2.577388594447341,false],[0.9323745950234809,false],[-0.25032440836547454,false],[1.1141701800611599,false],[1.1577408343996396,false],[0.4735089125920344,false],[-1.5559289264558278,false],[-0.11080485473390023,false],[0.1536430200356127,false],[1.2851073161790278,false],[-0.9717966387140513,false],[0.4604981927819666,false],[0.4825924627571432,false],[1.8907687599342153,false],[1.5027092114554406,false],[0.4892227077808574,false],[2.2742380779964306,false],[0.00593203161994782,false],[0.9357077683018076,false],[1.6452901327178684,false],[2.5989481778450294,false],[3.1233030636814103,false],[2.14412876458466,false],[0.8645332371791754,false],[1.7396751361758789,false],[3.406726808728102,false],[0.27592904706426413,false],[-0.47288172874607715,false],[3.1581200247451022,false],[2.3502844371874003,false],[2.3604518998272104,false],[2.875582435906723,false],[1.802101533727158,false],[2.158082491464444,false],[-0.5284223682158626,false],[0.01929919317533868,false],[1.948485504832782,false],[0.49379467644006303,false],[0.33811694243690293,false],[1.332171769010618,false],[0.6994701270153069,false],[-0.413721820026016,false],[-1.5522089380783108,false],[2.161396170492705,false],[0.02333496950423164,false],[-0.10913840839170796,false],[1.1299228472291496,false],[2.4274358384176584,false],[1.9359707345891741,false],[3.487722218477596,false],[0.9990127159196325,false],[-1.0398429191328207,false],[0.3005833334887211,false],[-0.7334628100431295,false],[0.4835865602253189,false],[0.5246945471836175,false],[0.8469783573593253,false],[0.8359162587262456,false],[0.7772016511976113,false],[-0.39849883029666944,false],[1.8703097604547239,false],[2.682932324516024,false],[0.46996888720103236,false],[-0.07881388366585762,false],[2.1043645061434084,false],[0.6195230903468327,false],[-0.23170755440676594,false],[0.3918168388047796,false],[0.22086080450987344,false],[1.5182059037248368,false],[1.6442851975073318,false],[0.3979663516003099,false],[2.0531657985840983,false],[1.7928797637680196,false],[2.9329556976986013,false],[1.1087520027663345,false],[1.2115868818351045,false],[1.9163661519192294,false],[1.6917128257752045,false],[1.0095879056962782,false],[-0.13611276130309613,false],[2.2939319088848023,false],[1.0723690693732042,false],[2.1452154961792393,false],[0.7259078662420231,false],[2.6599123456452727,false],[0.2519779820647646,false],[2.1670014817546175,false],[0.10506784220981513,false],[2.018185302480656,false],[1.1665983169452525,false],[0.33284879429952463,false],[0.3531339079979545,false],[2.1004784012229245,false],[1.282680965361929,false],[1.2270715852857979,false],[0.858598096986649,false],[2.5040344133072407,false],[1.6541952933075013,false],[0.5329588210461834,false],[2.1274892552565134,false],[1.4668875035709574,false],[1.5382758818248594,false],[1.7428172106530586,false],[1.4727771685178368,false],[1.6023481462981235,false],[1.6577898477375492,false],[0.05892056976555449,false],[2.7754262543475523,false],[1.2200523142327606,false],[1.5903756890326521,false],[-1.49547625208842,false],[0.8523817097750093,false],[0.5057853403549346,false],[0.5683629007876065,false],[1.6479513379049497,false],[1.2148679515188867,false],[0.6222019509815193,false],[1.3255067306263184,false],[0.4983375954130155,false],[-0.08802709440091383,false],[0.13831985322805507,false],[-0.5487242466777436,false],[-0.32058114510029334,false],[1.8950590840214767,false],[1.0062190610750874,false],[-0.9934439161367286,false],[0.3671557383587293,false],[0.19986189782147756,false],[-0.49653972053539497,false],[0.6848255848767759,false],[1.5219606199148406,false],[1.455086538348867,false],[2.883109155648917,false],[1.8164694435868296,false],[0.6742710281863775,false],[0.5441958963393487,false],[1.0517397813571259,false],[0.8356831003190489,false],[0.8227690076487093,false],[1.4570119880481842,false],[-0.297581775651637,false],[-0.07206180041345078,false],[-0.8739444049086391,false],[2.2604530979343074,false],[2.3872947344763027,false],[3.3685772895980124,false],[2.013534739447639,false],[3.368251328412311,false],[0.8953451648220483,false],[0.09545874578601765,false],[0.7718477167244377,false],[1.0629106168204554,false],[0.5518190802821734,false],[2.9939679918505853,false],[1.8726021041818661,false],[0.2653885457840085,false],[1.9872672471653996,false],[-0.553166557898946,false],[1.5640591286122745,false],[2.52680639118602,false],[1.80742439492357,false],[2.1955997975781347,false],[0.5980285235875027,false],[-0.2658797956060317,false],[-0.49719135472382137,false],[1.180607461695498,false],[-0.10430878902480734,false],[0.823892717854915,false],[1.666382974377688,false],[3.748395965408928,false],[0.017921581120532326,false],[0.7499355222636435,false],[2.3386705969751205,false],[0.4946954139770775,false],[2.7985296324540565,false],[1.5356765186629966,false],[-0.33706316690289584,false],[-0.010348117718002703,false],[1.8281804903673144,false],[0.3172404416132534,false],[0.5893972598101371,false],[1.5326653373112777,false],[0.8539589801933155,false],[2.092892033666929,false],[0.6296940385798598,false],[8.99959554980265,false],[1.3401791716063445,false],[0.1625728478606363,false],[1.1023716302273685,false],[1.3244294511594552,false],[1.9717106308848458,false],[2.0935027130112918,false],[0.5540124632067691,false],[2.8390489237342758,false],[1.2584888592967522,false],[0.8378223664277132,false],[-0.03705953427792741,false],[-0.01125595126556278,false],[1.8829278782190024,false],[2.0192085492627894,false],[1.9386320044059204,false],[1.651530725699678,false],[0.8017983775095935,false],[-0.03514905095054344,false],[0.8155367784375459,false],[-0.5552596097915619,false],[1.8705605094803621,false],[10.174199861232976,true],[1.4536718681041976,false],[2.1062700105302996,false],[0.475922933272229,false],[1.0817390501017392,false],[2.2796321965842496,false],[0.23323897979804842,false],[1.0183686887164103,false],[-0.7554454183477253,false],[1.3019096488805835,false],[0.3374802783657267,false],[-0.5146418960525585,false],[-0.06048075364364469,false],[-0.05967451256405276,false],[1.233114706332717,false],[1.7406224225514757,false],[0.5238094364159517,false],[-0.04455639893554597,false],[0.6178805181179535,false],[-0.8510251471391128,false],[1.308052246786863,false],[0.3268079413606899,false],[-1.3025175142774486,false],[0.5320039005955481,false],[0.12387407754502777,false],[2.6101947374495293,false],[1.5224492462759098,false],[1.236244816444764,false],[1.4954016347946228,false],[0.5281503216531209,false],[0.8463329768741992,false],[1.1634091418265289,false],[1.7554480003839843,false],[1.8947204310797423,false],[0.7506627891160538,false],[-0.22423697078143956,false],[0.927732550621745,false],[2.784360564469151,false],[3.542787218532106,false],[0.432227325280209,false],[-0.9685039345572555,false],[1.610702352432787,false],[0.25225428913555614,false],[0.6318605835098334,false],[0.24784246074544614,false],[1.3125827737308564,false],[1.76027763070149,false],[1.604542790844651,false],[0.9391947816971199,false],[2.0113202394281036,false],[0.6833889165055331,false],[0.7828049531781445,false],[1.525206927196617,false],[0.4555978800663196,false],[2.158504891725925,false],[0.5497336163750275,false],[1.108152719515001,false],[2.229598024152815,false],[-0.30715895940514804,false],[-0.4963457195725012,false],[0.6317891104976874,false],[0.9404446092196193,false],[0.5824240745249956,false],[0.9522827784866549,false],[0.5747278460881767,false],[2.3228717276929878,false],[-0.12232857339482872,false],[10.442627838980057,true],[-0.9613909203767632,false],[2.360115785393865,false],[10.460772141286911,true],[-0.15127677602688205,false],[-0.7430747891693794,false],[1.1166522423684635,false],[0.9764807692690883,false],[1.0545546293851562,false],[1.4217770365949636,false],[0.8472372480230154,false],[1.9293695381886482,false],[1.224477650092793,false],[-0.576902390274286,false],[1.327683339856686,false],[2.3294636041468753,false],[1.0508125817809573,false],[0.6893104376174488,false],[0.25055576676244107,false],[0.9140712539798914,false],[1.9321126051060917,false],[0.26607474319516033,false],[1.5039430223830939,false],[0.024155724118245736,false],[2.9529975781223285,false],[2.525931295222416,false],[3.0184656376604537,false],[1.3686271300712956,false],[0.4798723250356388,false],[-1.008710689163618,false],[1.5701794389127253,false],[0.19978829057056857,false],[0.9240761354395062,false],[0.19521466746159932,false],[1.2744043502827374,false],[-0.5431195983133648,false],[0.1974591476352352,false],[0.7430949008871768,false],[0.8988725739330019,false],[1.6597416237841465,false],[1.7417674159020793,false],[2.4088293700031693,false],[1.143581580663996,false],[1.4082585153064164,false],[0.47069873985209143,false],[-1.1580364942293953,false],[1.0732710931019263,false],[1.5509982425379119,false],[1.7677585939234246,false],[-1.1941141421872046,false],[0.21105300062231513,false],[0.6529477393919702,false],[-0.34988928270936226,false],[0.5444265493743319,false],[2.251577733100331,false],[0.16913394323406872,false],[11.260505056159252,true],[0.7864958296725808,false],[1.091593382604825,false],[0.7471169918052949,false],[0.36078054843777674,false],[1.4284182466312578,false],[0.3641673471149427,false],[-1.0360349861808262,false],[0.38230293118496894,false],[1.8786902260733145,false],[-0.7366326071049587,false],[2.0194567072200393,false],[0.5111298609273971,false],[1.947809368661851,false],[2.628034116556221,false],[0.10041127309972464,false],[-0.9914516842653798,false],[0.42604512187698185,false],[0.8384351974667634,false],[0.9068232484596871,false],[0.5738655218292824,false],[1.9264618723701152,false],[1.5761237325879685,false],[1.626292107129501,false],[2.0849065606469557,false],[-0.11343769134229165,false],[0.1025048999056456,false],[1.053052626678512,false],[-0.24007907992011845,false],[0.1382201206040784,false],[1.8910416626489552,false],[2.8345096657368556,false],[2.583170811237836,false],[-0.3893702721041865,false],[1.3520108244803342,false],[-0.12593338576537327,false],[-0.9808107291023687,false],[1.4015364735733753,false],[1.695547239092475,false],[1.3489569585825598,false],[0.8360821611908951,false],[0.33683162328320115,false],[-1.260138655228694,false],[1.6662817407344905,false],[2.273339646058636,false],[2.1408145302279262,false],[1.1532315762716479,false],[0.792000410181182,false],[2.617286787875776,false],[0.1827575511422984,false],[-0.9059473522304451,false],[-0.31032406628601605,false],[1.487891710861818,false],[-0.19990519218780256,false],[1.5228011808161672,false],[1.091160988784999,false],[-0.5446290704848642,false],[0.5171720764854166,false],[1.3467504967289186,false],[0.5028941713981121,false],[1.6926426850928427,false],[2.737520065317047,false],[-0.6337974959768131,false],[1.8334664621031571,false],[1.1752071580242511,false],[1.7663153320810179,false],[-0.03287929610234186,false],[0.9776991082096643,false],[0.7572719681136401,false],[2.0252498233787533,false],[2.0549863976236282,false],[0.28876880002288263,false],[0.7795217487076926,false],[0.5157176523746317,false],[1.2531709070474009,false],[2.814127875620211,false],[1.1251332829763616,false],[-0.8742006368438211,false],[3.525681357968375,false],[-0.6125196383989251,false],[-1.028539893085076,false],[1.944129606903108,false],[0.4230304057405415,false],[0.6337892280346704,false],[-0.6826244579330205,false],[0.4137789790932437,false],[2.133348714505998,false],[1.6093325024482905,false],[0.1403062548964249,false],[0.9977662561095119,false],[1.6154705922157153,false],[1.5325103216966767,false],[1.6480988802470689,false],[1.5457471122768636,false],[0.9278397921261037,false],[0.5346075472347933,false],[-0.3366100838774142,false],[1.544130227285287,false],[0.36057447512773,false],[3.1190339889208265,false],[0.5642439359943654,false],[0.036032355486391277,false],[1.217657470850345,false],[1.3708372094771342,false],[1.6204088991501409,false],[1.8068635367597905,false],[0.6836982699156782,false],[2.416660438805482,false],[1.435090083978466,false],[-0.6957004139189842,false],[2.796032650243188,false],[1.263889553950158,false],[-0.24234558620465552,false],[0.4126133154078948,false],[0.48194295180327873,false],[-0.04239311593641104,false],[2.131857833197308,false],[-0.15570995063363013,false],[0.7854482141700682,false],[1.8430551242641047,false],[-0.30696087051905785,false],[1.0556256557163515,false],[0.6908168936931991,false],[0.8953437823585769,false],[1.3572533765348747,false],[0.11398684036386209,false],[1.6619698080507603,false],[1.665250946590736,false],[0.8975920127377776,false],[2.2911345789955044,false],[0.9992259266914368,false],[-0.4298332988614957,false],[2.856688086679865,false],[9.905282503779972,true],[0.4160546198968119,false],[1.3074428261508197,false],[0.12330796113292308,false],[-0.08208866462136077,false],[0.43041154874660903,false],[-0.26805738332282525,false],[0.24248755197881344,false],[0.4672444655763044,false],[0.7429087035211764,false],[1.4882911024620438,false],[2.444968952436855,false],[-0.8041993598535895,false],[1.208622081250596,false],[0.08898983802592564,false],[1.8374497912460765,false],[2.770255925243865,false],[-0.8251005403922271,false],[-0.31615303993603194,false],[-0.06680911706266524,false],[-0.5060055961402281,false],[-0.10993772270902569,false],[-1.7858062514118545,false],[0.38124537958478155,false],[3.343016296304274,false],[3.200888498150916,false],[1.6539706630340567,false],[1.0358929561627934,false],[0.7349519148503848,false],[-0.5558335228136968,false],[0.8033111443298455,false],[1.0199590698825889,false],[1.3413895470645456,false],[1.7812455522573842,false],[0.5566880617934874,false],[2.3484161679464695,false],[1.1721286969240714,false],[1.985537497377007,false],[0.5028248990186489,false],[1.126187102927933,false],[1.098065463397298,false],[1.0022339510207767,false],[0.6524600640259166,false],[0.9129989416782233,false],[-0.04072646036731209,false],[-0.4997127716196892,false],[3.427010275934218,false],[-1.0592305386912666,false],[0.2158285556706534,false],[0.514825837851193,false],[1.8458680276815647,false],[0.6489366461843191,false],[1.4264428618420764,false],[1.8853463069064655,false],[0.9353141249181827,false],[-0.768007390555169,false],[-0.2825922690641738,false],[-0.11644476731169018,false],[1.5527313352517889,false],[1.361096472043486,false],[1.595550522072551,false],[0.7928138591830576,false],[2.4014413844006057,false],[0.9357181425237647,false],[1.0321537115844546,false],[1.017467185134316,false],[0.7544499732365095,false],[3.2914090464924084,false],[-0.30115720611734975,false],[1.1053894805207805,false],[0.24699783640458162,false],[-0.5754508908317295,false],[-0.7653405793793806,false],[2.551152606418246,false],[2.002335507569091,false],[2.873768745568216,false],[2.4779420958282303,false],[0.9919751607449626,false],[0.26553883660973165,false],[1.5810534545434005,false],[0.4363020620988478,false],[0.4208482016324523,false],[1.801337254210524,false],[0.7282927824660008,false],[2.370482819434382,false],[2.2689908454614955,false],[1.8992484787681332,false],[1.1345675892485614,false],[0.6800326573416028,false],[0.8256537442772758,false],[0.8771603935244864,false],[-1.0434719594542736,false],[0.8516519961407986,false],[2.185092193636852,false],[0.20653003088418287,false],[1.0609626373137258,false],[1.6312654872266645,false],[-0.10993816750885665,false],[2.511242528714717,false],[0.44520543525892353,false],[1.3189873412126392,false],[1.4382931017594118,false],[1.2450171964918337,false],[0.1075552521924854,false],[1.640701165992256,false],[1.5615637324174714,false],[0.8670086589057957,false],[-0.5321458051266028,false],[-0.0030490144428005905,false],[1.155437571970963,false],[2.0317104875172864,false],[0.10380445370650004,false],[1.5267461286865376,false],[9.102639076417908,true],[0.11175944316229147,false],[2.605816329847464,false],[-0.31757356268646797,false],[1.938296237870294,false],[2.623630455719459,false],[-0.17930511974208407,false],[0.22653773264797206,false],[0.7738024281145457,false],[0.8303926211791302,false],[3.8144763777667077,false],[0.2892406024466241,false],[0.279787632770216,false],[1.9176201484359812,false],[2.508246019756138,false],[1.4202553258576178,false],[0.8725425712951034,false],[2.590931954493854,false],[-0.6083285430052974,false],[0.3155829148992413,false],[0.9716424879068793,false],[-0.01933633148749392,false],[0.416940875088748,false],[0.9075871303206937,false],[-0.18322964916243012,false],[0.49834578143129415,false],[1.1523265845585398,false],[0.16862160117832925,false],[0.22112613360304012,false],[0.8542929631268784,false],[2.1065267442021933,false],[0.08716744674485033,false],[1.8741906276937679,false],[-0.8800017423117874,false],[0.985677419800145,false],[1.7814889560835554,false],[2.110674163627958,false],[0.6068631467692929,false],[2.010892494531559,false],[0.182773938051226,false],[0.9818670611842848,false],[1.5106418585391912,false],[0.27457120930224954,false],[3.131668044566185,false],[1.426032519824096,false],[2.756853957923013,false],[-0.08337312101971261,false],[-1.2512930084219307,false],[1.994731189314644,false],[1.5010954171753113,false],[1.6160885909571072,false],[0.997576086981748,false],[2.290454085433865,false],[1.5282322334484473,false],[0.9423457650293142,false],[-0.6929312351526271,false],[1.2117261668663954,false],[1.04304142983433,false],[0.09191415024846095,false],[-0.1856239446441006,false],[1.6459370551496064,false],[1.5887750906532614,false],[0.5153567867710697,false],[-0.5317451085692393,false],[1.2883518590500194,false],[-0.7231095994748975,false],[0.14806012859804774,false],[-1.1482141379213884,false],[-0.3327423570689081,false],[1.7898218176905512,false],[0.9371146998642512,false],[0.3889248981364597,false],[1.2257589408359904,false],[0.05216316163565138,false],[-0.032779385011159734,false],[0.9614097586524999,false],[4.39269909553782,false],[-0.291144125748688,false],[1.2868205085801738,false],[0.1096371776044478,false],[1.0358811391307199,false],[0.05805861249302269,false],[0.8985406306915447,false],[0.3622980657724947,false],[7.799859986587844,false],[-0.32465244606923727,false],[-0.11398647870671152,false],[2.507893114732872,false],[1.064845371081416,false],[0.5365179326980457,false],[1.7351202994151347,false],[0.8109120435203592,false],[0.3353686164143178,false],[0.4575130713351897,false],[1.544495758400612,false]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"value","type":"\"double\"","metadata":"{}"},{"name":"anomalous","type":"\"boolean\"","metadata":"{}"}],"overflow":true,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511434010086,"submitTime":1511434023643,"finishTime":1511434010531,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"lineChart","width":"993","height":"393","xColumns":["<id>"],"yColumns":["value"],"pivotColumns":["anomalous"],"pivotAggregation":"sum","customPlotOptions":{"lineChart":[]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9502c7d0-0875-4177-8733-007895c82515"},{"version":"CommandV1","origId":208451,"guid":"752e0391-8699-402d-9189-df9f7533e268","subtype":"command","commandType":"auto","position":2.9990234375,"command":"%md\n# Apply the batch-learnt T-Digest on a new stream of data\n\nFirst let's simulate historical data for batch-processing.\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"747de1e6-72de-47de-993a-692ffb15cfa0"},{"version":"CommandV1","origId":208493,"guid":"534b7b83-f197-4e7a-8f5f-b6301b0027b5","subtype":"command","commandType":"auto","position":3.4990234375,"command":"import scala.util.Random\nimport scala.util.Random._\n\n// simulate 5 bursts of historical data - emulate batch processing\n\n// make a sample to produce a mixture of two normal RVs with standard deviation 1 but with different location or mean parameters\ndef myMixtureOf2Normals( normalLocation: Double, abnormalLocation: Double, normalWeight: Double, r: Random) : (String, Double) = {\n  val sample = if (r.nextDouble <= normalWeight) {r.nextGaussian+normalLocation } \n               else {r.nextGaussian + abnormalLocation} \n  Thread.sleep(5L) // sleep 5 milliseconds\n  val now = (new java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss.SSS\")).format(new java.util.Date())\n  return (now,sample)\n   }\n   \n dbutils.fs.rm(\"/datasets/batchFiles/\",true) // this is to delete the directory before staring a job\n \nval r = new Random(123454321L)\nvar a = 0;\n// for loop execution to write files to distributed fs\nfor( a <- 1 to 5){\n  val data = sc.parallelize(Vector.fill(100){myMixtureOf2Normals(1.0, 10.0, 0.99, r)}).coalesce(1).toDF.as[(String,Double)]\n  val minute = (new java.text.SimpleDateFormat(\"mm\")).format(new java.util.Date())\n  val second = (new java.text.SimpleDateFormat(\"ss\")).format(new java.util.Date())\n  data.write.mode(SaveMode.Overwrite).csv(\"/datasets/batchFiles/\" + minute +\"_\" + second + \".csv\")\n  Thread.sleep(10L) // sleep 10 milliseconds\n}","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">import scala.util.Random\nimport scala.util.Random._\nmyMixtureOf2Normals: (normalLocation: Double, abnormalLocation: Double, normalWeight: Double, r: scala.util.Random)(String, Double)\nr: scala.util.Random = scala.util.Random@74ae0182\na: Int = 0\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1511446043970,"submitTime":1511445828556,"finishTime":1511446056156,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d6942462-e6d3-4c54-a546-eba0a4c86543"},{"version":"CommandV1","origId":208452,"guid":"d4b5aec4-711e-41b8-8863-441862c49890","subtype":"command","commandType":"auto","position":3.9990234375,"command":"display(dbutils.fs.ls(\"/datasets/batchFiles/\"))","commandVersion":0,"state":"finished","results":{"type":"table","data":[["dbfs:/datasets/batchFiles/07_25.csv/","07_25.csv/",0],["dbfs:/datasets/batchFiles/07_29.csv/","07_29.csv/",0],["dbfs:/datasets/batchFiles/07_31.csv/","07_31.csv/",0],["dbfs:/datasets/batchFiles/07_33.csv/","07_33.csv/",0],["dbfs:/datasets/batchFiles/07_35.csv/","07_35.csv/",0]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"path","type":"\"string\"","metadata":"{}"},{"name":"name","type":"\"string\"","metadata":"{}"},{"name":"size","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511446065646,"submitTime":1511446079483,"finishTime":1511446066154,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c7ff4e78-bf9d-4869-ba2b-f26224a1d1a7"},{"version":"CommandV1","origId":208494,"guid":"9b182097-81e5-45e5-91eb-fe65b551a50a","subtype":"command","commandType":"auto","position":4.4990234375,"command":"%md\nNow let's use a static DataFrame to process these files with t-digest and get the 0.99-th quantile based Cut-off.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e0776d1b-a93e-4af5-810e-803dc6bdaf61"},{"version":"CommandV1","origId":208495,"guid":"0ed137ec-579b-42f7-b0dc-b987f109d0ae","subtype":"command","commandType":"auto","position":4.7490234375,"command":"// Read all the csv files written atomically in a directory\nimport org.apache.spark.sql.types._\n\nval timedScore = new StructType().add(\"time\", \"timestamp\").add(\"score\", \"Double\")\n\nimport java.sql.{Date, Timestamp}\ncase class timedScoreCC(time: Timestamp, score: Double)\n\n//val streamingLines = sc.textFile(\"/datasets/streamingFiles/*\").toDF.as[String]\nval staticLinesDS = spark\n  .read\n  .option(\"sep\", \",\")\n  .schema(timedScore)      // Specify schema of the csv files\n  .csv(\"/datasets/batchFiles/*\").as[timedScoreCC]\n\nval udaf = tdigestUDAF[Double].delta(0.2).maxDiscrete(25)\n\nval batchLearntCutOff99 = staticLinesDS\n                  .agg(udaf($\"score\").as(\"td\"))\n                  .first.getAs[TDigestSQL](0)\n                  .tdigest\n                  .cdfInverse(0.99)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">import org.apache.spark.sql.types._\ntimedScore: org.apache.spark.sql.types.StructType = StructType(StructField(time,TimestampType,true), StructField(score,DoubleType,true))\nimport java.sql.{Date, Timestamp}\ndefined class timedScoreCC\nstaticLinesDS: org.apache.spark.sql.Dataset[timedScoreCC] = [time: timestamp, score: double]\nudaf: org.isarnproject.sketches.udaf.TDigestUDAF[Double] = TDigestUDAF(0.2,25)\nbatchLearntCutOff99: Double = 8.681901452463396\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511446447783,"submitTime":1511446461629,"finishTime":1511446449632,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"18f3d693-af79-497c-9b3f-a1704e8b4d02"},{"version":"CommandV1","origId":208496,"guid":"6e3c978d-320b-4d08-863b-9cc1358130a9","subtype":"command","commandType":"auto","position":5.2490234375,"command":"%md\nWe will next execute the companion notebook `040a_TDigestInputStream` in order to generate the files with the Gaussian mixture for streaming jobs.\n\nThe code in the companion notebook is as follows for convenience (you could just copy-paste this code into another notebook in the same cluster with the same distributed file system):\n\n```%scala\nimport scala.util.Random\nimport scala.util.Random._\n\n// make a sample to produce a mixture of two normal RVs with standard deviation 1 but with different location or mean parameters\ndef myMixtureOf2Normals( normalLocation: Double, abnormalLocation: Double, normalWeight: Double, r: Random) : (String, Double) = {\n  val sample = if (r.nextDouble <= normalWeight) {r.nextGaussian+normalLocation } \n               else {r.nextGaussian + abnormalLocation} \n  Thread.sleep(5L) // sleep 5 milliseconds\n  val now = (new java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss.SSS\")).format(new java.util.Date())\n  return (now,sample)\n   }\n   \n dbutils.fs.rm(\"/datasets/streamingFiles/\",true) // this is to delete the directory before staring a job\n \nval r = new Random(12345L)\nvar a = 0;\n// for loop execution to write files to distributed fs\nfor( a <- 1 to 20){\n  val data = sc.parallelize(Vector.fill(100){myMixtureOf2Normals(1.0, 10.0, 0.99, r)}).coalesce(1).toDF.as[(String,Double)]\n  val minute = (new java.text.SimpleDateFormat(\"mm\")).format(new java.util.Date())\n  val second = (new java.text.SimpleDateFormat(\"ss\")).format(new java.util.Date())\n  data.write.mode(SaveMode.Overwrite).csv(\"/datasets/streamingFiles/\" + minute +\"_\" + second + \".csv\")\n  Thread.sleep(5000L) // sleep 5 seconds\n}\n```\n\nWe will simply apply the batch-learnt t-digest as the threshold for determining if the streaming data is anomalous or not.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"760f5799-8238-446a-a5ce-4f680ab23201"},{"version":"CommandV1","origId":208456,"guid":"35e2c5e3-f38f-44cf-b9c9-24df1df1999c","subtype":"command","commandType":"auto","position":6.2490234375,"command":"import org.apache.spark.sql.types._\nimport java.sql.{Date, Timestamp}\n\nval timedScore = new StructType().add(\"time\", \"timestamp\").add(\"score\", \"Double\")\ncase class timedScoreCC(time: Timestamp, score: Double)\n\nval streamingLinesDS = spark\n  .readStream\n  .option(\"sep\", \",\")\n  .schema(timedScore)      // Specify schema of the csv files\n  .csv(\"/datasets/streamingFiles/*\").as[timedScoreCC]","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">import org.apache.spark.sql.types._\nimport java.sql.{Date, Timestamp}\ntimedScore: org.apache.spark.sql.types.StructType = StructType(StructField(time,TimestampType,true), StructField(score,DoubleType,true))\ndefined class timedScoreCC\nstreamingLinesDS: org.apache.spark.sql.Dataset[timedScoreCC] = [time: timestamp, score: double]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<div class=\"ansiout\">notebook:7: error: type mismatch;\n found   : timedScoreCC.type\n required: org.apache.spark.sql.types.StructType\n.schema(timedScoreCC)      // Specify schema of the csv files\n        ^\n</div>","error":null,"workflows":[],"startTime":1511446726939,"submitTime":1511446740798,"finishTime":1511446728247,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ba9d9282-4e1e-4008-8527-cb39452c5acc"},{"version":"CommandV1","origId":208457,"guid":"b6665147-296d-472a-91c2-aa72988bbc58","subtype":"command","commandType":"auto","position":6.3740234375,"command":"//display(streamingLinesDS)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1511446522471,"submitTime":1511446536288,"finishTime":1511446522788,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6b201a91-74a6-4734-9978-c59a8ac892b0"},{"version":"CommandV1","origId":208463,"guid":"1fed9ea6-3091-442e-8afe-754d0c7fc117","subtype":"command","commandType":"auto","position":7.7958984375,"command":"%md\nNow, we can apply this batch-learnt cut-off from the static DataSet to the streaming DataSet. \n\nThis is a simple example of learning in batch mode (say overnight or every few hours) and applying it to live streaming data.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"12c4b0f0-ae66-47a1-bb46-4aa3c2549c5e"},{"version":"CommandV1","origId":208464,"guid":"d52d44e3-73db-4bef-9c04-b5a125953802","subtype":"command","commandType":"auto","position":7.9677734375,"command":"// Start running the query that prints the running counts to the console\nval dataFalgged = streamingLinesDS\n      .withColumn(\"anomalous\",$\"score\" > batchLearntCutOff99).filter($\"anomalous\")\n      .writeStream\n      //.outputMode(\"complete\")\n      .format(\"console\")\n      .start()\n\ndataFalgged.awaitTermination() // hit cancel to terminate","commandVersion":0,"state":"error","results":{"type":"html","data":"<div class=\"ansiout\">-------------------------------------------\nBatch: 0\n-------------------------------------------\n+--------------------+------------------+---------+\n|                time|             score|anomalous|\n+--------------------+------------------+---------+\n|2017-11-23 14:18:...| 9.423175513609095|     true|\n|2017-11-23 14:18:...|11.539205812425335|     true|\n|2017-11-23 14:18:...| 9.639219241219372|     true|\n+--------------------+------------------+---------+\n\n-------------------------------------------\nBatch: 1\n-------------------------------------------\n+----+-----+---------+\n|time|score|anomalous|\n+----+-----+---------+\n+----+-----+---------+\n\n-------------------------------------------\nBatch: 2\n-------------------------------------------\n+--------------------+------------------+---------+\n|                time|             score|anomalous|\n+--------------------+------------------+---------+\n|2017-11-23 14:19:...|  8.99959554980265|     true|\n|2017-11-23 14:19:...|10.174199861232976|     true|\n+--------------------+------------------+---------+\n\n-------------------------------------------\nBatch: 3\n-------------------------------------------\n+--------------------+------------------+---------+\n|                time|             score|anomalous|\n+--------------------+------------------+---------+\n|2017-11-23 14:19:...|10.442627838980057|     true|\n|2017-11-23 14:19:...|10.460772141286911|     true|\n|2017-11-23 14:19:...|11.260505056159252|     true|\n+--------------------+------------------+---------+\n\n-------------------------------------------\nBatch: 4\n-------------------------------------------\n+--------------------+-----------------+---------+\n|                time|            score|anomalous|\n+--------------------+-----------------+---------+\n|2017-11-23 14:19:...|9.905282503779972|     true|\n+--------------------+-----------------+---------+\n\n-------------------------------------------\nBatch: 5\n-------------------------------------------\n+----+-----+---------+\n|time|score|anomalous|\n+----+-----+---------+\n+----+-----+---------+\n\n-------------------------------------------\nBatch: 6\n-------------------------------------------\n+--------------------+-----------------+---------+\n|                time|            score|anomalous|\n+--------------------+-----------------+---------+\n|2017-11-23 14:19:...|9.102639076417908|     true|\n+--------------------+-----------------+---------+\n\n-------------------------------------------\nBatch: 7\n-------------------------------------------\n+----+-----+---------+\n|time|score|anomalous|\n+----+-----+---------+\n+----+-----+---------+\n\n-------------------------------------------\nBatch: 8\n-------------------------------------------\n+--------------------+------------------+---------+\n|                time|             score|anomalous|\n+--------------------+------------------+---------+\n|2017-11-23 14:19:...| 9.695132992174205|     true|\n|2017-11-23 14:19:...|10.439052640762693|     true|\n+--------------------+------------------+---------+\n\n-------------------------------------------\nBatch: 9\n-------------------------------------------\n+--------------------+-----------------+---------+\n|                time|            score|anomalous|\n+--------------------+-----------------+---------+\n|2017-11-23 14:19:...|10.02254460606071|     true|\n|2017-11-23 14:19:...|9.311690918035534|     true|\n+--------------------+-----------------+---------+\n\n-------------------------------------------\nBatch: 10\n-------------------------------------------\n+--------------------+-----------------+---------+\n|                time|            score|anomalous|\n+--------------------+-----------------+---------+\n|2017-11-23 14:19:...|9.454926349089147|     true|\n+--------------------+-----------------+---------+\n\n-------------------------------------------\nBatch: 11\n-------------------------------------------\n+--------------------+----------------+---------+\n|                time|           score|anomalous|\n+--------------------+----------------+---------+\n|2017-11-23 14:20:...|9.87803253322451|     true|\n+--------------------+----------------+---------+\n\n-------------------------------------------\nBatch: 12\n-------------------------------------------\n+----+-----+---------+\n|time|score|anomalous|\n+----+-----+---------+\n+----+-----+---------+\n\n-------------------------------------------\nBatch: 13\n-------------------------------------------\n+--------------------+-----------------+---------+\n|                time|            score|anomalous|\n+--------------------+-----------------+---------+\n|2017-11-23 14:20:...|9.858438409632281|     true|\n|2017-11-23 14:20:...|10.45683581285141|     true|\n+--------------------+-----------------+---------+\n\n-------------------------------------------\nBatch: 14\n-------------------------------------------\n+--------------------+-----------------+---------+\n|                time|            score|anomalous|\n+--------------------+-----------------+---------+\n|2017-11-23 14:20:...|9.311726779124077|     true|\n|2017-11-23 14:20:...|8.994959541314255|     true|\n+--------------------+-----------------+---------+\n\n-------------------------------------------\nBatch: 15\n-------------------------------------------\n+----+-----+---------+\n|time|score|anomalous|\n+----+-----+---------+\n+----+-----+---------+\n\n-------------------------------------------\nBatch: 16\n-------------------------------------------\n+----+-----+---------+\n|time|score|anomalous|\n+----+-----+---------+\n+----+-----+---------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1511446744284,"submitTime":1511446744284,"finishTime":1511449090671,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3bf5e07f-a4ee-4e4f-a25e-e84d2be72c93"},{"version":"CommandV1","origId":208497,"guid":"f98b6669-08e8-4dcf-ab9e-39655731500e","subtype":"command","commandType":"auto","position":8.4677734375,"command":"%md\nAlthough the above pattern of estimating the 99% Cut-Off periodically by batch-processing static DataSets from historical data and then applying these Cut-Offs to filter anamolous data points that are currently streaming at us is *good enough* for several applications, we may want to do *online estimation/learning* of the Cut-Off based on the 99% of all the data up to present time and use this *live* Cut-off to decide which point is anamolous now.\n\nFor this we need to use more delicate parts of Structured Streaming.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2d209fae-861c-423b-ac68-4760e310f8a1"},{"version":"CommandV1","origId":208479,"guid":"940ea84c-20fe-4368-82b5-cecf5086fbfc","subtype":"command","commandType":"auto","position":8.9677734375,"command":"%md\n# Streaming T-Digest - Online Updating of the Cut-Off\n\nTo impelment a streaming t-digest of the data that keeps the current threshold and a current t-digest, we need to get into more delicate parts of structured streaming and implement our own `flatMapgroupsWithState`.\n\nHere are some starting points for diving deeper in this direction of *arbitrary stateful processing*:\n\n* [https://databricks.com/blog/2017/10/17/arbitrary-stateful-processing-in-apache-sparks-structured-streaming.html](https://databricks.com/blog/2017/10/17/arbitrary-stateful-processing-in-apache-sparks-structured-streaming.html).\n* Spark Summit EU Dublin 2017 Deep Dive: [https://databricks.com/session/deep-dive-stateful-stream-processing](https://databricks.com/session/deep-dive-stateful-stream-processing)\n* See [https://youtu.be/JAb4FIheP28](https://youtu.be/JAb4FIheP28)\n* Official [docs and examples of arbitrary stateful operations](https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#arbitrary-stateful-operations)\n  * doc: [https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.streaming.GroupState](https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.streaming.GroupState)\n  * example: [https://github.com/apache/spark/blob/v2.2.0/examples/src/main/scala/org/apache/spark/examples/sql/streaming/StructuredSessionization.scala](https://github.com/apache/spark/blob/v2.2.0/examples/src/main/scala/org/apache/spark/examples/sql/streaming/StructuredSessionization.scala)\n\n* See [Part 14](http://blog.madhukaraphatak.com/introduction-to-spark-structured-streaming-part-14/) of [the 14-part series on structured streaming series in Madhukar's blog](http://blog.madhukaraphatak.com/categories/introduction-structured-streaming/) \n* Authoritative resource: [https://jaceklaskowski.gitbooks.io/spark-structured-streaming/content/spark-sql-streaming-KeyValueGroupedDataset-flatMapGroupsWithState.html](https://jaceklaskowski.gitbooks.io/spark-structured-streaming/content/spark-sql-streaming-KeyValueGroupedDataset-flatMapGroupsWithState.html)\n\n# Streaming Machine Learning and Structured Streaming\n\nUltimately we want to use structured streaming for online machine learning algorithms and not just sketching.\n\n* See Spark Summit 2016 video on streaming ML (streaming logistic regression): [https://youtu.be/r0hyjmLMMOc](https://youtu.be/r0hyjmLMMOc)\n* [Holden Karau's codes from High Performance Spark Book](https://github.com/holdenk/spark-structured-streaming-ml/tree/master/src/main/scala/com/high-performance-spark-examples/structuredstreaming)\n\n# Data Engineering Science Pointers\n\nUsing kafka, Cassandra and Spark Structured Streaming\n\n* [https://github.com/ansrivas/spark-structured-streaming](https://github.com/ansrivas/spark-structured-streaming)\n* [https://github.com/polomarcus/Spark-Structured-Streaming-Examples](https://github.com/polomarcus/Spark-Structured-Streaming-Examples)\n","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e1a4d10e-4ed6-4e6c-ae9a-94e950f459b4"}],"dashboards":[],"guid":"8b916f7e-724b-481f-a166-fb3923cfef05","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}};</script>
<script
 src="https://databricks-prod-cloudfront.cloud.databricks.com/static/7f9cefa92f0da43a505f7213ef5a6bb5d4a409ec4e0540a0a55701946063455d/js/metrics-graphics.js"
 onerror="window.mainJsLoadError = true;"></script>
<script
 src="https://databricks-prod-cloudfront.cloud.databricks.com/static/7f9cefa92f0da43a505f7213ef5a6bb5d4a409ec4e0540a0a55701946063455d/js/notebook-main.js"
 onerror="window.mainJsLoadError = true;"></script>
</head>
<body>
  <script>
if (window.mainJsLoadError) {
  var u = 'https://databricks-prod-cloudfront.cloud.databricks.com/static/7f9cefa92f0da43a505f7213ef5a6bb5d4a409ec4e0540a0a55701946063455d/js/notebook-main.js';
  var b = document.getElementsByTagName('body')[0];
  var c = document.createElement('div');
  c.innerHTML = ('<h1>Network Error</h1>' +
    '<p><b>Please check your network connection and try again.</b></p>' +
    '<p>Could not load a required resource: ' + u + '</p>');
  c.style.margin = '30px';
  c.style.padding = '20px 50px';
  c.style.backgroundColor = '#f5f5f5';
  c.style.borderRadius = '5px';
  b.appendChild(c);
}
</script>
</body>
</html>
